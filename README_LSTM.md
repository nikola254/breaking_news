# Модуль анализа и прогнозирования индекса социальной напряжённости

Данный модуль предназначен для анализа и прогнозирования индекса социальной напряжённости на основе данных, собираемых парсерами из различных источников (Telegram, новостные сайты). Модуль использует LSTM (Long Short-Term Memory) нейронную сеть для обработки временных рядов показателей и предсказания динамики интегрального индекса напряжённости.

## Структура модуля

Модуль состоит из следующих компонентов:

1. **tension_lstm_model.py** - основной класс LSTM модели для анализа и прогнозирования
2. **tension_monitor.py** - система мониторинга для автоматического обновления прогнозов
3. **run_tension_analysis.py** - скрипт для запуска анализа и визуализации результатов

## Установка зависимостей

Для работы модуля необходимо установить дополнительные зависимости:

```bash
pip install -r requarements.txt
```

Основные зависимости:
- tensorflow - для создания и обучения LSTM модели
- numpy, pandas - для обработки данных
- matplotlib, seaborn - для визуализации результатов
- scikit-learn - для предобработки данных и оценки модели
- schedule - для планирования регулярных обновлений прогноза

## Использование

### Однократный прогноз

Для создания однократного прогноза индекса напряжённости выполните:

```bash
python run_tension_analysis.py --train --visualize
```

Опции:
- `--train` - обучить модель перед прогнозированием
- `--visualize` - создать визуализацию прогноза
- `--days N` - количество дней для прогноза (по умолчанию 3)
- `--lookback N` - количество дней в истории для предсказания (по умолчанию 7)

### Запуск системы мониторинга

Для запуска системы мониторинга с автоматическим обновлением прогнозов:

```bash
python run_tension_analysis.py --monitor
```

Система мониторинга будет:
- Обновлять прогноз каждые 24 часа
- Переобучать модель раз в неделю (по понедельникам)
- Создавать визуализации и отчеты в директориях `plots` и `reports`

### Прямое использование классов

Вы также можете использовать классы напрямую в своем коде:

```python
from tension_lstm_model import TensionLSTMModel

# Создание модели
model = TensionLSTMModel(lookback=7, forecast_days=5)

# Запуск полного пайплайна: загрузка данных, обучение, прогноз
forecast = model.run_full_pipeline(train=True, visualize=True)

# Вывод прогноза
print(forecast)
```

## Интеграция с существующей системой

Модуль интегрируется с существующей системой мониторинга следующим образом:

1. Данные собираются парсерами и сохраняются в ClickHouse
2. LSTM модель обрабатывает эти данные и создает прогноз
3. Система мониторинга автоматически обновляет прогнозы при поступлении новых данных

## Структура данных

Модель использует следующие данные из ClickHouse:

- Количество сообщений из Telegram-каналов
- Средняя длина сообщений
- Количество новостей из других источников

На основе этих данных вычисляется интегральный индекс напряжённости, который затем используется для прогнозирования.

## Визуализация результатов

Результаты прогнозирования визуализируются в виде графиков, показывающих:

- Исторические значения индекса напряжённости
- Прогнозируемые значения на указанный период
- Тренд изменения индекса

Графики сохраняются в директории `plots`.

## Отчеты

Система мониторинга создает текстовые отчеты с анализом текущей ситуации и прогнозом. Отчеты содержат:

- Текущее значение индекса напряжённости
- Прогнозируемые значения на указанный период
- Анализ тренда (рост, снижение, стабильность)
- Интерпретацию результатов

Отчеты сохраняются в директории `reports`.