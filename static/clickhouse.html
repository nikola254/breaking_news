<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NewsAnalytics - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö ClickHouse</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #0a1f3d;
            color: #e0e0e0;
        }
        .header {
            background-color: #0d2b50;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #4fc3f7;
            display: flex;
            align-items: center;
        }
        .logo-icon {
            margin-right: 10px;
            font-size: 28px;
        }
        .main-nav {
            display: flex;
        }
        .main-nav a {
            color: #bbdefb;
            text-decoration: none;
            padding: 10px 15px;
            margin: 0 5px;
            border-radius: 4px;
            transition: all 0.3s;
        }
        .main-nav a:hover {
            background-color: #1e3a6a;
            color: #ffffff;
        }
        .user-actions {
            display: flex;
            align-items: center;
        }
        .user-actions button {
            background-color: #1976d2;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
            transition: all 0.3s;
        }
        .user-actions button:hover {
            background-color: #1565c0;
        }
        .content {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .db-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .db-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .db-btn {
            background-color: #1e3a6a;
            color: #bbdefb;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .db-btn.active {
            background-color: #1976d2;
            color: white;
        }
        .db-btn:hover {
            background-color: #1565c0;
            color: white;
        }
        .filter-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }
        .filter-select, .days-select {
            background-color: #0d2b50;
            color: #e0e0e0;
            border: 1px solid #1976d2;
            padding: 8px;
            border-radius: 4px;
        }
        .news-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: #0d2b50;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        .news-table th, .news-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #1e3a6a;
        }
        .news-table th {
            background-color: #1e3a6a;
            color: #4fc3f7;
            position: sticky;
            top: 0;
        }
        .news-table tr:hover {
            background-color: #1e3a6a;
        }
        .date-col {
            width: 120px;
        }
        .source-col {
            width: 120px;
        }
        .title-col {
            width: 250px;
        }
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            gap: 5px;
        }
        .page-btn {
            background-color: #1e3a6a;
            color: #bbdefb;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .page-btn.active {
            background-color: #1976d2;
            color: white;
        }
        .page-btn:hover {
            background-color: #1565c0;
            color: white;
        }
        .footer {
            background-color: #0d2b50;
            padding: 15px 20px;
            text-align: center;
            margin-top: 30px;
            color: #bbdefb;
        }
        .loading {
            text-align: center;
            padding: 20px;
            font-size: 18px;
            color: #4fc3f7;
        }
        .error-message {
            background-color: #c62828;
            color: white;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        .link-cell a {
            color: #4fc3f7;
            text-decoration: none;
        }
        .link-cell a:hover {
            text-decoration: underline;
        }
        .content-cell {
            max-width: 400px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .content-cell.expanded {
            white-space: normal;
        }
        .expand-btn {
            background-color: transparent;
            color: #4fc3f7;
            border: none;
            cursor: pointer;
            padding: 0;
            margin-left: 5px;
            font-size: 12px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.7);
        }
        
        .modal-content {
            background-color: #0d2b50;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #1976d2;
            border-radius: 8px;
            width: 80%;
            max-width: 900px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            color: #e0e0e0;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #1e3a6a;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        
        .modal-title {
            font-size: 22px;
            color: #4fc3f7;
            margin: 0;
        }
        
        .close-modal {
            color: #bbdefb;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
        }
        
        .close-modal:hover {
            color: #4fc3f7;
        }
        
        .modal-body {
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .modal-footer {
            border-top: 1px solid #1e3a6a;
            padding-top: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .article-meta {
            color: #bbdefb;
            font-size: 14px;
        }
        
        .article-link {
            color: #4fc3f7;
            text-decoration: none;
        }
        
        .article-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">
            <span class="logo-icon">üìä</span> NewsAnalytics Pro
        </div>
        <div class="main-nav">
            <a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="/analytics">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a>
            <a href="/clickhouse" class="active">–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</a>
            <a href="/reports">–û—Ç—á–µ—Ç—ã</a>
            <a href="/trends">–¢—Ä–µ–Ω–¥—ã</a>
            <a href="/forecast">–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ</a>
            <a href="/archive">–ê—Ä—Ö–∏–≤</a>
            <a href="/about">–û –ø—Ä–æ–µ–∫—Ç–µ</a>
        </div>
        <div class="user-actions">
            <button id="parse-btn">–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥</button>
            <button id="refresh-btn">–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
        </div>
    </div>
    
    <div class="content">
        <h1>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö ClickHouse</h1>
        <div id="error-container"></div>
        
        <div class="db-controls">
            <div class="db-selector">
                <button class="db-btn active" data-source="telegram">Telegram</button>
                <button class="db-btn" data-source="israil">–ò–∑—Ä–∞–∏–ª—å</button>
                <button class="db-btn" data-source="ria">–†–ò–ê</button>
            </div>
            
            <div class="filter-controls">
                <div id="filter-container">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã -->
                </div>
                
                <label for="days-select">–ü–µ—Ä–∏–æ–¥:</label>
                <select id="days-select" class="days-select">
                    <option value="1">1 –¥–µ–Ω—å</option>
                    <option value="3">3 –¥–Ω—è</option>
                    <option value="7" selected>7 –¥–Ω–µ–π</option>
                    <option value="14">14 –¥–Ω–µ–π</option>
                    <option value="30">30 –¥–Ω–µ–π</option>
                </select>
            </div>
        </div>
        
        <div id="loading" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
        
        <table class="news-table" id="data-table">
            <thead>
                <tr id="table-header">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã -->
                </tr>
            </thead>
            <tbody id="table-body"></tbody>
        </table>
        
        <div class="pagination" id="pagination"></div>
    </div>
    
    <div class="footer">
        ¬© 2025 NewsAnalytics Pro. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã. | Leck | Smuzi
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∞—Ç—å–∏ -->
    <div id="article-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-title">–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–∞—Ç—å–∏</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body" id="modal-content">
                –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏...
            </div>
            <div class="modal-footer">
                <div class="article-meta">
                    <span id="modal-source">–ò—Å—Ç–æ—á–Ω–∏–∫</span> | 
                    <span id="modal-date">–î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</span>
                </div>
                <a href="#" target="_blank" id="modal-link" class="article-link">–û—Ç–∫—Ä—ã—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª</a>
            </div>
        </div>
    </div>
    
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentSource = 'telegram';
        let currentPage = 1;
        let currentFilter = null;
        let currentFilterValue = null;
        let currentDays = 7;
        let totalPages = 1;
        
        // DOM-—ç–ª–µ–º–µ–Ω—Ç—ã
        const dataTable = document.getElementById('data-table');
        const tableHeader = document.getElementById('table-header');
        const tableBody = document.getElementById('table-body');
        const pagination = document.getElementById('pagination');
        const loading = document.getElementById('loading');
        const errorContainer = document.getElementById('error-container');
        const filterContainer = document.getElementById('filter-container');
        const daysSelect = document.getElementById('days-select');
        const refreshBtn = document.getElementById('refresh-btn');
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤—ã–±–æ—Ä–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö
            document.querySelectorAll('.db-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.db-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentSource = btn.dataset.source;
                    currentPage = 1;
                    currentFilter = null;
                    currentFilterValue = null;
                    loadData();
                });
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–∏–æ–¥–∞
            daysSelect.addEventListener('change', () => {
                currentDays = parseInt(daysSelect.value);
                currentPage = 1;
                loadData();
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            refreshBtn.addEventListener('click', () => {
                loadData();
            });
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            loadData();
        });
        
        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ API
        function loadData() {
            showLoading(true);
            clearError();
            
            // –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ URL –∑–∞–ø—Ä–æ—Å–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
            let url = `/api/${currentSource}?page=${currentPage}&days=${currentDays}`;
            if (currentFilter && currentFilterValue) {
                url += `&${currentFilter}=${encodeURIComponent(currentFilterValue)}`;
            }
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                        updateTable(data.data);
                        updatePagination(data.total_pages, data.current_page);
                        updateFilters(data);
                        totalPages = data.total_pages;
                    } else {
                        showError(data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö');
                    }
                })
                .catch(error => {
                    showError(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö: ${error.message}`);
                })
                .finally(() => {
                    showLoading(false);
                });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã —Å –¥–∞–Ω–Ω—ã–º–∏
        function updateTable(data) {
            // –û—á–∏—Å—Ç–∫–∞ —Ç–∞–±–ª–∏—Ü—ã
            tableHeader.innerHTML = '';
            tableBody.innerHTML = '';
            
            if (data.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="5" style="text-align: center;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</td></tr>';
                return;
            }
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —Ç–∞–±–ª–∏—Ü—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞
            const headers = getHeadersForSource(currentSource);
            headers.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header.label;
                if (header.class) th.className = header.class;
                tableHeader.appendChild(th);
            });
            
            // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –¥–∞–Ω–Ω—ã–º–∏
            data.forEach(item => {
                const row = document.createElement('tr');
                
                headers.forEach(header => {
                    const cell = document.createElement('td');
                    
                    if (header.key === 'link' || header.key === 'message_link') {
                        // –î–ª—è —Å—Å—ã–ª–æ–∫ —Å–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç <a>
                        cell.className = 'link-cell';
                        if (item[header.key]) {
                            const link = document.createElement('a');
                            link.href = item[header.key];
                            link.target = '_blank';
                            link.textContent = '–û—Ç–∫—Ä—ã—Ç—å';
                            cell.appendChild(link);
                        } else {
                            cell.textContent = '-';
                        }
                    } else if (header.key === 'content') {
                        // –î–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–æ–±–∞–≤–ª—è–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è
                        cell.className = 'content-cell';
                        cell.textContent = item[header.key] || '-';
                        
                        if (item[header.key] && item[header.key].length > 100) {
                            const expandBtn = document.createElement('button');
                            expandBtn.className = 'expand-btn';
                            expandBtn.textContent = '[–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å]';
                            expandBtn.addEventListener('click', () => {
                                cell.classList.toggle('expanded');
                                expandBtn.textContent = cell.classList.contains('expanded') ? '[–°–≤–µ—Ä–Ω—É—Ç—å]' : '[–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å]';
                            });
                            cell.appendChild(expandBtn);
                        }
                    } else if (header.key === 'title') {
                        // –î–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ –¥–æ–±–∞–≤–ª—è–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                        cell.className = 'title-col';
                        cell.textContent = item[header.key] || '-';
                        cell.style.cursor = 'pointer';
                        cell.title = '–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –ø–æ–ª–Ω—É—é —Å—Ç–∞—Ç—å—é';
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                        cell.addEventListener('click', () => {
                            openArticleModal(item);
                        });
                    } else {
                        // –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –ø—Ä–æ—Å—Ç–æ –≤—ã–≤–æ–¥–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ
                        cell.textContent = item[header.key] || '-';
                    }
                    
                    row.appendChild(cell);
                });
                
                tableBody.appendChild(row);
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —Ç–∞–±–ª–∏—Ü—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞
        function getHeadersForSource(source) {
            switch (source) {
                case 'telegram':
                    return [
                        { key: 'parsed_date', label: '–î–∞—Ç–∞', class: 'date-col' },
                        { key: 'channel', label: '–ö–∞–Ω–∞–ª', class: 'source-col' },
                        { key: 'title', label: '–ó–∞–≥–æ–ª–æ–≤–æ–∫', class: 'title-col' },
                        { key: 'content', label: '–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ' },
                        { key: 'message_link', label: '–°—Å—ã–ª–∫–∞' }
                    ];
                case 'israil':
                    return [
                        { key: 'parsed_date', label: '–î–∞—Ç–∞', class: 'date-col' },
                        { key: 'source', label: '–ò—Å—Ç–æ—á–Ω–∏–∫', class: 'source-col' },
                        { key: 'category', label: '–ö–∞—Ç–µ–≥–æ—Ä–∏—è' },
                        { key: 'title', label: '–ó–∞–≥–æ–ª–æ–≤–æ–∫', class: 'title-col' },
                        { key: 'content', label: '–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ' },
                        { key: 'link', label: '–°—Å—ã–ª–∫–∞' }
                    ];
                case 'ria':
                    return [
                        { key: 'parsed_date', label: '–î–∞—Ç–∞', class: 'date-col' },
                        { key: 'source', label: '–ò—Å—Ç–æ—á–Ω–∏–∫', class: 'source-col' },
                        { key: 'category', label: '–ö–∞—Ç–µ–≥–æ—Ä–∏—è' },
                        { key: 'title', label: '–ó–∞–≥–æ–ª–æ–≤–æ–∫', class: 'title-col' },
                        { key: 'content', label: '–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ' },
                        { key: 'link', label: '–°—Å—ã–ª–∫–∞' }
                    ];
                default:
                    return [];
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
        function updatePagination(totalPages, currentPage) {
            pagination.innerHTML = '';
            
            if (totalPages <= 1) return;
            
            // –ö–Ω–æ–ø–∫–∞ "–ü—Ä–µ–¥—ã–¥—É—â–∞—è"
            if (currentPage > 1) {
                addPageButton('¬´', currentPage - 1);
            }
            
            // –ù–æ–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, startPage + 4);
            
            for (let i = startPage; i <= endPage; i++) {
                addPageButton(i, i, i === currentPage);
            }
            
            // –ö–Ω–æ–ø–∫–∞ "–°–ª–µ–¥—É—é—â–∞—è"
            if (currentPage < totalPages) {
                addPageButton('¬ª', currentPage + 1);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–∫–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
        function addPageButton(text, page, isActive = false) {
            const button = document.createElement('button');
            button.className = `page-btn${isActive ? ' active' : ''}`;
            button.textContent = text;
            button.addEventListener('click', () => {
                if (page !== currentPage) {
                    currentPage = page;
                    loadData();
                }
            });
            pagination.appendChild(button);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function updateFilters(data) {
            filterContainer.innerHTML = '';
            
            let filterOptions = [];
            let filterName = '';
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞
            if (currentSource === 'telegram' && data.available_channels) {
                filterOptions = data.available_channels;
                filterName = 'channel';
                createFilterSelect('–ö–∞–Ω–∞–ª:', filterName, filterOptions);
            } else if ((currentSource === 'israil' || currentSource === 'ria') && data.available_categories) {
                filterOptions = data.available_categories;
                filterName = 'category';
                createFilterSelect('–ö–∞—Ç–µ–≥–æ—Ä–∏—è:', filterName, filterOptions);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
        function createFilterSelect(label, filterName, options) {
            const container = document.createElement('div');
            container.style.display = 'flex';
            container.style.alignItems = 'center';
            container.style.gap = '10px';
            
            const labelElement = document.createElement('label');
            labelElement.textContent = label;
            container.appendChild(labelElement);
            
            const select = document.createElement('select');
            select.className = 'filter-select';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–ø—Ü–∏—é "–í—Å–µ"
            const allOption = document.createElement('option');
            allOption.value = '';
            allOption.textContent = '–í—Å–µ';
            select.appendChild(allOption);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option;
                optionElement.textContent = option;
                if (currentFilter === filterName && currentFilterValue === option) {
                    optionElement.selected = true;
                }
                select.appendChild(optionElement);
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–∞
            select.addEventListener('change', () => {
                currentFilter = select.value ? filterName : null;
                currentFilterValue = select.value;
                currentPage = 1;
                loadData();
            });
            
            container.appendChild(select);
            filterContainer.appendChild(container);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è/—Å–∫—Ä—ã—Ç–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏
        function showLoading(show) {
            loading.style.display = show ? 'block' : 'none';
            dataTable.style.display = show ? 'none' : 'table';
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—à–∏–±–∫–∏
        function showError(message) {
            errorContainer.innerHTML = `<div class="error-message">${message}</div>`;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –æ—à–∏–±–∫–∏
        function clearError() {
            errorContainer.innerHTML = '';
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å–æ —Å—Ç–∞—Ç—å–µ–π
        function openArticleModal(article) {
            const modal = document.getElementById('article-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalContent = document.getElementById('modal-content');
            const modalSource = document.getElementById('modal-source');
            const modalDate = document.getElementById('modal-date');
            const modalLink = document.getElementById('modal-link');
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–º–∏ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            modalTitle.textContent = article.title || '–ë–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞';
            modalContent.textContent = article.content || '–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç';
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
            if (currentSource === 'telegram') {
                modalSource.textContent = article.channel || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–∞–Ω–∞–ª';
            } else {
                modalSource.textContent = article.source || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫';
            }
            
            modalDate.textContent = article.parsed_date || '–î–∞—Ç–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞';
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª
            if (article.link) {
                modalLink.href = article.link;
                modalLink.style.display = 'inline';
            } else if (article.message_link) {
                modalLink.href = article.message_link;
                modalLink.style.display = 'inline';
            } else {
                modalLink.style.display = 'none';
            }
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            modal.style.display = 'block';
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            const closeBtn = modal.querySelector('.close-modal');
            closeBtn.onclick = function() {
                modal.style.display = 'none';
            }
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            window.onclick = function(event) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –∑–∞–ø—É—Å–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞
        document.getElementById('parse-btn').addEventListener('click', function() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –ø–∞—Ä—Å–∏–Ω–≥–∞? –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è.')) {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—ã–±–æ—Ä–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
                openParserSelectionModal();
            }
        });
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –≤—ã–±–æ—Ä–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
        function openParserSelectionModal() {
            // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ, –µ—Å–ª–∏ –µ–≥–æ –µ—â–µ –Ω–µ—Ç
            if (!document.getElementById('parserSelectionModal')) {
                const modal = document.createElement('div');
                modal.id = 'parserSelectionModal';
                modal.className = 'modal';
                modal.innerHTML = `
                    <div class="modal-content">
                        <span class="close">&times;</span>
                        <h2>–í—ã–±–µ—Ä–∏—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞</h2>
                        <div class="parser-options">
                            <label><input type="checkbox" name="parser" value="telegram" checked> Telegram</label>
                            <label><input type="checkbox" name="parser" value="israil" checked> –ò–∑—Ä–∞–∏–ª—å</label>
                            <label><input type="checkbox" name="parser" value="ria" checked> –†–ò–ê</label>
                        </div>
                        <button id="startParsingBtn" class="btn btn-primary">–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥</button>
                    </div>
                `;
                document.body.appendChild(modal);
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                const style = document.createElement('style');
                style.textContent = `
                    .modal {
                        display: none;
                        position: fixed;
                        z-index: 1000;
                        left: 0;
                        top: 0;
                        width: 100%;
                        height: 100%;
                        background-color: rgba(0,0,0,0.4);
                    }
                    .modal-content {
                        background-color: #fefefe;
                        margin: 15% auto;
                        padding: 20px;
                        border: 1px solid #888;
                        width: 400px;
                        border-radius: 5px;
                    }
                    .close {
                        color: #aaa;
                        float: right;
                        font-size: 28px;
                        font-weight: bold;
                        cursor: pointer;
                    }
                    .close:hover {
                        color: black;
                    }
                    .parser-options {
                        margin: 20px 0;
                    }
                    .parser-options label {
                        display: block;
                        margin: 10px 0;
                    }
                `;
                document.head.appendChild(style);
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                document.querySelector('#parserSelectionModal .close').addEventListener('click', function() {
                    document.getElementById('parserSelectionModal').style.display = 'none';
                });
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –∑–∞–ø—É—Å–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞
                document.getElementById('startParsingBtn').addEventListener('click', function() {
                    const selectedParsers = [];
                    document.querySelectorAll('#parserSelectionModal input[name="parser"]:checked').forEach(checkbox => {
                        selectedParsers.push(checkbox.value);
                    });
                    
                    if (selectedParsers.length === 0) {
                        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞');
                        return;
                    }
                    
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                    document.getElementById('parserSelectionModal').style.display = 'none';
                    
                    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–∞—Ä—Å–∏–Ω–≥ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
                    runParsers(selectedParsers);
                });
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            document.getElementById('parserSelectionModal').style.display = 'block';
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø–∞—Ä—Å–µ—Ä–æ–≤
        function runParsers(sources) {
            showLoading(true);
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –∑–∞–ø—É—Å–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞
            fetch('/api/run_parser', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ source: sources.length === 3 ? 'all' : sources.join(',') })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    alert('–ü–∞—Ä—Å–∏–Ω–≥ —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω! –û–±–Ω–æ–≤–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç.');
                } else {
                    showError(data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø–∞—Ä—Å–∏–Ω–≥–∞');
                }
            })
            .catch(error => {
                showError(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø–∞—Ä—Å–∏–Ω–≥–∞: ${error.message}`);
            })
            .finally(() => {
                showLoading(false);
            });
            }
    </script>
</body>
</html>