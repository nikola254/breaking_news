{% extends "base.html" %}

{% block title %}NewsAnalytics - –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/analytics.css') }}">
<style>
    .stats-number {
    font-size: 18px !important;
        font-weight: bold;
    }
    
    .stats-label {
    font-size: 12px !important;
}

.news-container {
    max-height: 600px;
    overflow-y: auto;
}

.news-card {
    background: white;
    border: none;
    border-radius: 16px;
    margin-bottom: 15px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
    overflow: hidden;
    cursor: pointer;
    position: relative;
}

.news-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
    transition: all 0.3s ease;
}

.news-card-body {
    padding: 25px;
    color: #2c3e50;
    position: relative;
    z-index: 2;
}

.news-title {
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 12px;
    line-height: 1.4;
    color: #2c3e50;
}

.news-title a {
    color: #2c3e50;
    text-decoration: none;
    transition: color 0.3s ease;
}

.news-title a:hover {
    color: #34495e;
}

.news-content {
    font-size: 15px;
    line-height: 1.6;
    margin-bottom: 18px;
    color: #5a6c7d;
}

.news-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    font-size: 13px;
}

.news-meta-item {
    display: flex;
    align-items: center;
    gap: 6px;
    background: rgba(108, 117, 125, 0.1);
    padding: 6px 12px;
    border-radius: 20px;
    font-weight: 500;
    color: #6c757d;
    transition: all 0.3s ease;
}

.news-meta-item:hover {
    background: rgba(108, 117, 125, 0.15);
    transform: translateY(-1px);
}

.news-meta-item i {
    font-size: 12px;
    color: #6c757d;
}

.news-tension {
    background: rgba(220, 53, 69, 0.1);
    color: #dc3545;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 600;
}

.news-spike {
    background: rgba(102, 16, 242, 0.1);
    color: #6610f2;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: bold;
}

.news-source {
    background: rgba(52, 152, 219, 0.3);
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: bold;
}

.news-time {
    background: rgba(46, 204, 113, 0.3);
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: bold;
}

.no-news {
    text-align: center;
    padding: 40px;
    color: #6c757d;
}

    .no-news i {
    font-size: 48px;
    margin-bottom: 20px;
    opacity: 0.5;
    }

/* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è */
.chart-card {
    overflow: hidden;
}

.chart-placeholder {
    overflow: hidden;
    max-width: 100%;
}

.chart-placeholder canvas {
    max-width: 100%;
    height: auto;
    display: block;
}

/* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è —Ç–µ–ø–ª–æ–≤–æ–π –∫–∞—Ä—Ç—ã */
#sourcesChart {
    overflow: hidden;
}

#sourcesChart canvas {
    max-width: 100%;
}

/* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –∫—Ä—É–≥–æ–≤–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã */
#territoryChart canvas {
    max-width: 100%;
}

/* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç–∏ */
#tensionChart {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
}

#tensionChart canvas {
    max-width: 100%;
    height: auto;
    display: block;
    margin: 0 auto;
}

#tensionChart .chart-placeholder {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    width: 100%;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="analytics-header text-center">
        <h1 class="mb-3">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π</h1>
        <p class="mb-0">–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –Ω–æ–≤–æ—Å—Ç–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ –∏ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç–∏</p>
    </div>
    
    <!-- –§–∏–ª—å—Ç—Ä—ã –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card filter-card">
                <div class="card-header">
                    <h5 class="mb-0">üîç –§–∏–ª—å—Ç—Ä—ã</h5>
                </div>
                <div class="card-body">
                    <div class="form-group mb-3">
                        <label for="categorySelect" class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                        <select class="form-control" id="categorySelect">
                            <option value="all">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                            <option value="military_operations">–í–æ–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</option>
                            <option value="military_operations_demo">üéØ –í–æ–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–î–µ–º–æ)</option>
                            <option value="humanitarian_crisis">–ì—É–º–∞–Ω–∏—Ç–∞—Ä–Ω—ã–π –∫—Ä–∏–∑–∏—Å</option>
                            <option value="economic_consequences">–≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è</option>
                            <option value="political_decisions">–ü–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è</option>
                            <option value="information_social">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ-—Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã</option>
                        </select>
                    </div>
                    <div class="form-group mb-3">
                        <label for="dateRange" class="form-label">–ü–µ—Ä–∏–æ–¥:</label>
                        <select class="form-control" id="dateRange">
                            <option value="7">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π</option>
                            <option value="30">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π</option>
                            <option value="90">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 3 –º–µ—Å—è—Ü–∞</option>
                        </select>
                    </div>
                    <button class="btn btn-analytics w-100" onclick="updateAnalytics()">
                        üîÑ –û–±–Ω–æ–≤–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É
                    </button>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card filter-card">
                <div class="card-header">
                    <h5 class="mb-0">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <!-- –ì—Ä—É–ø–ø–∞ 1: –ù–æ–≤–æ—Å—Ç–∏ –∏ —Ç—Ä–µ–Ω–¥ -->
                        <div class="col-md-6">
                            <div class="stats-card">
                                <div class="stats-number" id="totalNews">-</div>
                                <div class="stats-label">üì∞ –í—Å–µ–≥–æ –Ω–æ–≤–æ—Å—Ç–µ–π</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="stats-card">
                                <div class="stats-number" id="trendIndicator">-</div>
                                <div class="stats-label">üìä –¢—Ä–µ–Ω–¥</div>
                            </div>
                        </div>
                        
                        <!-- –ì—Ä—É–ø–ø–∞ 2: –ù–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç—å –∏ –∏–Ω–¥–µ–∫—Å –≤—Å–ø–ª–µ—Å–∫–∞ -->
                        <div class="col-md-6">
                            <div class="stats-card">
                                <div class="stats-number" id="avgTension">-</div>
                                <div class="stats-label">üå°Ô∏è –ò–Ω—Ç–µ–≥—Ä–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç–∏</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="stats-card">
                                <div class="stats-number" id="avgSpike">-</div>
                                <div class="stats-label">üìà –ò–Ω–¥–µ–∫—Å –≤—Å–ø–ª–µ—Å–∫–∞</div>
                            </div>
                        </div>
                        
                        <!-- –ì—Ä—É–ø–ø–∞ 3: –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ —Å–∫–æ—Ä–æ—Å—Ç—å -->
                        <div class="col-md-6">
                            <div class="stats-card">
                                <div class="stats-number" id="socialActivity">-</div>
                                <div class="stats-label">üî• –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="stats-card">
                                <div class="stats-number" id="newsVelocity">-</div>
                                <div class="stats-label">‚ö° –°–∫–æ—Ä–æ—Å—Ç—å –Ω–æ–≤–æ—Å—Ç–µ–π/—á–∞—Å</div>
                            </div>
                        </div>
                        
                        <!-- –ì—Ä—É–ø–ø–∞ 4: –ü–∏–∫–æ–≤—ã–π —á–∞—Å -->
                        <div class="col-md-6">
                            <div class="stats-card">
                                <div class="stats-number" id="peakHour">-</div>
                                <div class="stats-label">üïê –ü–∏–∫–æ–≤—ã–π —á–∞—Å</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    

    
    <!-- –ì—Ä–∞—Ñ–∏–∫–∏ -->
    <div class="row">
        <div>
            <div class="card chart-card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">üìà –î–∏–Ω–∞–º–∏–∫–∞ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç–∏ —Å –ø—Ä–æ–≥–Ω–æ–∑–æ–º</h5>
                </div>
                <div class="card-body">
                    <div id="tensionChart" class="text-center">
                        <div class="loading-spinner">
                            <div class="spinner-custom"></div>
                            <p class="mt-2 text-muted">–ó–∞–≥—Ä—É–∑–∫–∞ –∏ —Ä–∞—Å—á–µ—Ç –¥–∞–Ω–Ω—ã—Ö...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-md-6">
            <div class="card chart-card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">üó∫Ô∏è –ü–æ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è–º</h5>
                </div>
                <div class="card-body">
                    <div id="territoryChart" class="text-center">
                        <div class="loading-spinner">
                            <div class="spinner-custom"></div>
                            <p class="mt-2 text-muted">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card chart-card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">üî• –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞</h5>
                </div>
                <div class="card-body">
                    <div id="sourcesChart" class="text-center">
                        <div class="loading-spinner">
                            <div class="spinner-custom"></div>
                            <p class="mt-2 text-muted">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –Ω–æ–≤–æ—Å—Ç–µ–π -->
    <div class="row">
        <div class="col-12">
            <div class="card chart-card">
                <div class="card-header">
                    <h5 class="mb-0">üì∞ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏</h5>
                </div>
                <div class="card-body">
                    <div id="newsContainer" class="news-container">
                        <div class="text-center py-4">
                                        <div class="loading-spinner">
                                            <div class="spinner-custom"></div>
                                            <p class="mt-2 text-muted">–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π...</p>
                                        </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∞—Ç—å–∏ -->
<div id="newsModal" class="news-modal-overlay">
    <div class="news-modal-content">
        <div class="news-modal-header">
            <h2 id="modalTitle"></h2>
            <button class="news-modal-close" onclick="closeNewsModal()">&times;</button>
        </div>
        <div class="news-modal-body">
            <div class="news-modal-meta">
                <div class="news-modal-meta-item">
                    <i class="fas fa-calendar-alt"></i>
                    <strong>–î–∞—Ç–∞:</strong>
                    <span id="modalDate"></span>
                </div>
                <div class="news-modal-meta-item">
                    <i class="fas fa-newspaper"></i>
                    <strong>–ò—Å—Ç–æ—á–Ω–∏–∫:</strong>
                    <span id="modalSource"></span>
                </div>
                <div class="news-modal-meta-item">
                    <i class="fas fa-tag"></i>
                    <strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong>
                    <span id="modalCategory"></span>
                </div>
                <div class="news-modal-meta-item">
                    <i class="fas fa-chart-line"></i>
                    <strong>–ù–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç—å:</strong>
                    <span id="modalTension"></span>
                </div>
            </div>
            <div class="news-modal-content-text" id="modalContent"></div>
        </div>
        <div class="news-modal-footer">
            <a id="modalLink" href="#" target="_blank" class="news-modal-link">
                <i class="fas fa-external-link-alt"></i>
                –ß–∏—Ç–∞—Ç—å –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–µ
            </a>
        </div>
    </div>
</div>
<script>
// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
function updateAnalytics() {
    const category = document.getElementById('categorySelect').value;
    const dateRange = document.getElementById('dateRange').value;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä—ã
    showLoadingSpinners();
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    loadStatistics(category, dateRange);
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≥—Ä–∞—Ñ–∏–∫ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç–∏ —Å –ø—Ä–æ–≥–Ω–æ–∑–æ–º
    if (category === 'military_operations_demo') {
        // –î–ª—è –¥–µ–º–æ-–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è –≤–æ–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
        loadRealTensionChart('military_operations', dateRange);
    } else {
        loadRealTensionChart(category, dateRange);
    }
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≥—Ä–∞—Ñ–∏–∫–∏
    loadCharts(category, dateRange);
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏
    loadNewsTable(category, dateRange);
}

function showLoadingSpinners() {
    document.getElementById('tensionChart').innerHTML = `
        <div class="text-center">
            <div class="spinner-border" role="status">
                <span class="sr-only">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
            <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
        </div>`;
    
    document.getElementById('territoryChart').innerHTML = `
        <div class="text-center">
            <div class="spinner-border" role="status">
                <span class="sr-only">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
            <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
        </div>`;
    
    document.getElementById('sourcesChart').innerHTML = `
        <div class="text-center">
            <div class="spinner-border" role="status">
                <span class="sr-only">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
            <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
        </div>`;
}

function loadStatistics(category, dateRange) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π "–í–æ–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏"
    if (category === 'military_operations_demo') {
        loadMilitaryStatistics();
        return;
    }
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (–≤–∫–ª—é—á–∞—è —Ç—Ä–µ–Ω–¥ –∏ —Å–æ—Ü–∏–∞–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å)
    fetch(`/api/ukraine_analytics/full_statistics?category=${category}&days=${dateRange}`)
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                const totalNewsElement = document.getElementById('totalNews');
                const trendIndicatorElement = document.getElementById('trendIndicator');
                const socialActivityElement = document.getElementById('socialActivity');
                const newsVelocityElement = document.getElementById('newsVelocity');
                const peakHourElement = document.getElementById('peakHour');
                
                if (totalNewsElement) totalNewsElement.textContent = data.total_news || '0';
                if (trendIndicatorElement) trendIndicatorElement.textContent = data.trend || '‚Üí –°—Ç–∞–±–∏–ª—å–Ω–æ';
                if (socialActivityElement) socialActivityElement.textContent = data.social_activity || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
                if (newsVelocityElement) newsVelocityElement.textContent = data.news_velocity || '0';
                if (peakHourElement) peakHourElement.textContent = data.peak_hour || '00:00';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º sentimentTrend —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                const sentimentTrendElement = document.getElementById('sentimentTrend');
                if (sentimentTrendElement) {
                    sentimentTrendElement.textContent = data.sentiment_trend || '‚Üí –°—Ç–∞–±–∏–ª—å–Ω—ã–π';
                }
            }
        })
        .catch(error => {
            console.error('Error loading full statistics:', error);
            const totalNewsElement = document.getElementById('totalNews');
            const trendIndicatorElement = document.getElementById('trendIndicator');
            const socialActivityElement = document.getElementById('socialActivity');
            
            if (totalNewsElement) totalNewsElement.textContent = '–û—à–∏–±–∫–∞';
            if (trendIndicatorElement) trendIndicatorElement.textContent = '–û—à–∏–±–∫–∞';
            if (socialActivityElement) socialActivityElement.textContent = '–û—à–∏–±–∫–∞';
        });
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç–∏
    fetch(`/api/ukraine_analytics/social_tension_statistics?category=${category}&days=${dateRange}`)
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                const avgTensionElement = document.getElementById('avgTension');
                const avgSpikeElement = document.getElementById('avgSpike');
                
                if (avgTensionElement) {
                    avgTensionElement.textContent = 
                        data.avg_tension ? data.avg_tension.toFixed(1) + '%' : '0%';
                }
                
                if (avgSpikeElement) {
                    avgSpikeElement.textContent = 
                        data.avg_spike ? data.avg_spike.toFixed(1) + '%' : '0%';
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ç—Ä–µ–Ω–¥–∞ (–µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
                const trendElement = document.getElementById('tensionTrend');
                if (trendElement) {
                    trendElement.textContent = getTrendText(data.trend);
                    trendElement.className = `trend-indicator ${data.trend}`;
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç–∏
                updateTensionDistribution(data.tension_distribution);
            }
        })
        .catch(error => {
            console.error('Error loading tension statistics:', error);
            const avgTensionElement = document.getElementById('avgTension');
            const avgSpikeElement = document.getElementById('avgSpike');
            
            if (avgTensionElement) avgTensionElement.textContent = '–û—à–∏–±–∫–∞';
            if (avgSpikeElement) avgSpikeElement.textContent = '–û—à–∏–±–∫–∞';
        });
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ —Ç—Ä–µ–Ω–¥–∞
function getTrendText(trend) {
    switch(trend) {
        case 'rising': return '‚Üó –†–∞—Å—Ç–µ—Ç';
        case 'falling': return '‚Üò –°–Ω–∏–∂–∞–µ—Ç—Å—è';
        case 'stable': return '‚Üí –°—Ç–∞–±–∏–ª—å–Ω–æ';
        default: return '‚Üí –°—Ç–∞–±–∏–ª—å–Ω–æ';
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç–∏
function updateTensionDistribution(distribution) {
    const container = document.getElementById('tensionDistribution');
    if (!container || !distribution) return;
    
    const categories = {
        'critical': { name: '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è', color: '#8e44ad' },
        'high': { name: '–í—ã—Å–æ–∫–∞—è', color: '#e74c3c' },
        'medium': { name: '–°—Ä–µ–¥–Ω—è—è', color: '#e67e22' },
        'low': { name: '–ù–∏–∑–∫–∞—è', color: '#f1c40f' },
        'minimal': { name: '–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è', color: '#2ecc71' }
    };
    
    let html = '<div class="tension-distribution">';
    for (const [level, count] of Object.entries(distribution)) {
        const category = categories[level];
        if (category && count > 0) {
            html += `
                <div class="tension-item">
                    <span class="tension-color" style="background-color: ${category.color}"></span>
                    <span class="tension-label">${category.name}</span>
                    <span class="tension-count">${count}</span>
                </div>
            `;
        }
    }
    html += '</div>';
    container.innerHTML = html;
}

function loadCharts(category, dateRange) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π "–í–æ–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏"
    if (category === 'military_operations_demo') {
        loadMilitaryOperationsDemo(dateRange);
    } else {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        loadRealCharts(category, dateRange);
    }
}

function loadMilitaryOperationsDemo(dateRange) {
    // –≠—Ç–∞–ª–æ–Ω–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è "–í–æ–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏" —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
    
    // 1. –î–∏–∞–≥—Ä–∞–º–º–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è–º
    createMilitaryTerritoryChart();
    
    // 2. –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
    createMilitaryHeatmap();
    
    // 3. –ì—Ä–∞—Ñ–∏–∫ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç–∏
    createMilitaryTensionChart();
}

function createMilitaryTerritoryChart() {
    document.getElementById('territoryChart').innerHTML = `
        <div class="chart-placeholder">
            <canvas id="militaryTerritoryCanvas" width="700" height="450"></canvas>
        </div>
    `;
    
    const canvas = document.getElementById('militaryTerritoryCanvas');
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2 - 20;
    const radius = 130;
    
    // –≠—Ç–∞–ª–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–æ–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
    const data = [
        { territory: '–î–æ–Ω–µ—Ü–∫–∞—è –æ–±–ª–∞—Å—Ç—å', percent: 35, count: 1250, color: '#e17055' },
        { territory: '–õ—É–≥–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', percent: 28, count: 980, color: '#fab1a0' },
        { territory: '–•–∞—Ä—å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', percent: 18, count: 640, color: '#ffeaa7' },
        { territory: '–ó–∞–ø–æ—Ä–æ–∂—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', percent: 12, count: 420, color: '#fff3cd' },
        { territory: '–•–µ—Ä—Å–æ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', percent: 7, count: 250, color: '#e8f5e8' }
    ];
    const totalNews = 3540;
    
    // –ó–∞–ª–∏–≤–∫–∞ —Ñ–æ–Ω–∞
    ctx.fillStyle = '#ffffff';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // –ó–∞–≥–æ–ª–æ–≤–æ–∫
    ctx.fillStyle = '#2c3e50';
    ctx.font = 'bold 18px Arial';
    ctx.textAlign = 'center';
    ctx.fillText(`–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–µ–π –ø–æ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è–º - –í–æ–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (${totalNews.toLocaleString()} –≤—Å–µ–≥–æ)`, centerX, 30);
    
    // –†–∏—Å—É–µ–º –∫—Ä—É–≥–æ–≤—É—é –¥–∏–∞–≥—Ä–∞–º–º—É
    let currentAngle = -Math.PI / 2;
    data.forEach((item, index) => {
        const sliceAngle = (item.percent / 100) * 2 * Math.PI;
        
        // –°–µ–∫—Ç–æ—Ä
        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
        ctx.closePath();
        ctx.fillStyle = item.color;
        ctx.fill();
        
        // –ë–µ–ª–∞—è –æ–±–≤–æ–¥–∫–∞
        ctx.strokeStyle = '#ffffff';
        ctx.lineWidth = 3;
        ctx.stroke();
        
        currentAngle += sliceAngle;
    });
    
    // –õ–µ–≥–µ–Ω–¥–∞ —Å–Ω–∏–∑—É
    const legendY = centerY + radius + 50;
    const legendItemWidth = 180;
    const startX = (canvas.width - (legendItemWidth * 2)) / 2;
    
    data.forEach((item, index) => {
        const row = Math.floor(index / 2);
        const col = index % 2;
        const x = startX + col * legendItemWidth;
        const y = legendY + row * 35;
        
        // –¶–≤–µ—Ç–Ω–æ–π –∫–≤–∞–¥—Ä–∞—Ç
        ctx.fillStyle = item.color;
        ctx.fillRect(x, y - 10, 20, 20);
        ctx.strokeStyle = '#ffffff';
        ctx.lineWidth = 2;
        ctx.strokeRect(x, y - 10, 20, 20);
        
        // –¢–µ–∫—Å—Ç —Å –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏
        ctx.fillStyle = '#2c3e50';
        ctx.font = 'bold 12px Arial';
        ctx.textAlign = 'left';
        ctx.textBaseline = 'middle';
        ctx.fillText(item.territory + ' - ' + item.percent + '%', x + 28, y);
        ctx.font = '11px Arial';
        ctx.fillStyle = '#6c757d';
        ctx.fillText(item.count.toLocaleString() + ' –Ω–æ–≤–æ—Å—Ç–µ–π', x + 28, y + 12);
    });
}

function createMilitaryHeatmap() {
    document.getElementById('sourcesChart').innerHTML = `
        <div class="chart-placeholder">
            <canvas id="militaryHeatmapCanvas" width="1200" height="550"></canvas>
        </div>
    `;
    
    const heatCanvas = document.getElementById('militaryHeatmapCanvas');
    if (!heatCanvas) return;
    
    const ctx = heatCanvas.getContext('2d');
    const sources = [
        '–†–ò–ê –ù–æ–≤–æ—Å—Ç–∏', 'Lenta.ru', '–†–ë–ö', '–ì–∞–∑–µ—Ç–∞.ru', '–ö–æ–º–º–µ—Ä—Å–∞–Ω—Ç—ä', 
        'Reuters', 'CNN', 'BBC', 'Interfax', '–¢–ê–°–°'
    ];
    const days = ['–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞', '–°—É–±–±–æ—Ç–∞', '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ'];
    const cellWidth = 100;
    const cellHeight = 40;
    const startX = 160;
    const startY = 80;
    
    // –≠—Ç–∞–ª–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–æ–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
    const heatData = [
        [85, 92, 88, 95, 89, 45, 38],  // –†–ò–ê –ù–æ–≤–æ—Å—Ç–∏
        [78, 84, 79, 86, 82, 41, 35],  // Lenta.ru
        [82, 88, 85, 91, 87, 43, 37],  // –†–ë–ö
        [68, 75, 71, 78, 74, 32, 28],  // –ì–∞–∑–µ—Ç–∞.ru
        [71, 78, 74, 81, 77, 35, 30],  // –ö–æ–º–º–µ—Ä—Å–∞–Ω—Ç—ä
        [95, 98, 96, 99, 97, 55, 48],  // Reuters
        [98, 99, 97, 100, 98, 58, 51], // CNN
        [88, 91, 89, 93, 90, 48, 42],  // BBC
        [75, 81, 78, 84, 80, 38, 33],  // Interfax
        [90, 94, 92, 96, 93, 52, 45]   // –¢–ê–°–°
    ];
    
    // –ó–∞–ª–∏–≤–∫–∞ —Ñ–æ–Ω–∞
    ctx.fillStyle = '#ffffff';
    ctx.fillRect(0, 0, heatCanvas.width, heatCanvas.height);
    
    // –ó–∞–≥–æ–ª–æ–≤–æ–∫
    ctx.fillStyle = '#2c3e50';
    ctx.font = 'bold 20px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏–π –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º –∑–∞ –Ω–µ–¥–µ–ª—é - –í–æ–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏', heatCanvas.width / 2, 35);
    
    // –†–∏—Å—É–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–Ω–µ–π
    ctx.font = 'bold 11px Arial';
    ctx.fillStyle = '#2c3e50';
    ctx.textAlign = 'center';
    days.forEach((day, i) => {
        ctx.fillText(day, startX + i * cellWidth + cellWidth / 2, startY - 20);
    });
    
    // –†–∏—Å—É–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∏ —è—á–µ–π–∫–∏
    sources.forEach((source, i) => {
        // –ù–∞–∑–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
        ctx.fillStyle = '#2c3e50';
        ctx.font = 'bold 12px Arial';
        ctx.textAlign = 'right';
        ctx.textBaseline = 'middle';
        ctx.fillText(source, startX - 10, startY + i * cellHeight + cellHeight / 2);
        
        days.forEach((day, j) => {
            const value = heatData[i][j];
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç –ø–æ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏
            let color;
            if (value < 40) color = '#e8f5e8';      // –û—á–µ–Ω—å –Ω–∏–∑–∫–∞—è
            else if (value < 60) color = '#fff3cd';  // –ù–∏–∑–∫–∞—è
            else if (value < 80) color = '#ffeaa7';  // –°—Ä–µ–¥–Ω—è—è
            else if (value < 90) color = '#fab1a0';  // –í—ã—Å–æ–∫–∞—è
            else color = '#e17055';                  // –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è
            
            // –†–∏—Å—É–µ–º —è—á–µ–π–∫—É
            ctx.fillStyle = color;
            ctx.fillRect(
                startX + j * cellWidth, 
                startY + i * cellHeight, 
                cellWidth - 4, 
                cellHeight - 4
            );
            
            // –ë–µ–ª–∞—è —Ä–∞–º–∫–∞
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 2;
            ctx.strokeRect(
                startX + j * cellWidth, 
                startY + i * cellHeight, 
                cellWidth - 4, 
                cellHeight - 4
            );
            
            // –ó–Ω–∞—á–µ–Ω–∏–µ –≤ —è—á–µ–π–∫–µ
            ctx.fillStyle = '#2c3e50';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(
                value, 
                startX + j * cellWidth + (cellWidth - 4) / 2, 
                startY + i * cellHeight + (cellHeight - 4) / 2
            );
        });
    });
    
    // –õ–µ–≥–µ–Ω–¥–∞
    const legendX = startX;
    const legendY = startY + sources.length * cellHeight + 30;
    
    ctx.fillStyle = '#2c3e50';
    ctx.font = 'bold 12px Arial';
    ctx.textAlign = 'left';
    ctx.fillText('–£—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:', legendX, legendY);
    
    const legendItems = [
        { label: '–û—á–µ–Ω—å –Ω–∏–∑–∫–∞—è (0-39)', color: '#e8f5e8' },
        { label: '–ù–∏–∑–∫–∞—è (40-59)', color: '#fff3cd' },
        { label: '–°—Ä–µ–¥–Ω—è—è (60-79)', color: '#ffeaa7' },
        { label: '–í—ã—Å–æ–∫–∞—è (80-89)', color: '#fab1a0' },
        { label: '–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è (90+)', color: '#e17055' }
    ];
    
    legendItems.forEach((item, index) => {
        const x = legendX + index * 200;
        const y = legendY + 20;
        
        ctx.fillStyle = item.color;
        ctx.fillRect(x, y - 8, 16, 16);
        ctx.strokeStyle = '#ffffff';
        ctx.lineWidth = 1;
        ctx.strokeRect(x, y - 8, 16, 16);
        
        ctx.fillStyle = '#2c3e50';
        ctx.font = '11px Arial';
        ctx.textAlign = 'left';
        ctx.fillText(item.label, x + 25, y + 2);
    });
}

function createMilitaryTensionChart() {
    const chartContainer = document.getElementById('tensionChart');
    chartContainer.innerHTML = `
        <div class="chart-placeholder">
            <canvas id="militaryTensionCanvas" width="1200" height="500"></canvas>
            <div class="mt-3" style="color: #2c3e50;">
                <div class="row text-center">
                    <div class="col-md-3">
                        <strong style="color: #4a90e2;">üìä –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö —Ç–æ—á–µ–∫:</strong><br>7 / 7
                    </div>
                    <div class="col-md-3">
                        <strong style="color: #7b68ee;">üîÆ –ü—Ä–æ–≥–Ω–æ–∑–Ω—ã—Ö —Ç–æ—á–µ–∫:</strong><br>5
                    </div>
                    <div class="col-md-3">
                        <strong style="color: #6c757d;">üìà –°—Ä–µ–¥–Ω—è—è –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç—å:</strong><br>78.5%
                    </div>
                    <div class="col-md-3">
                        <strong style="color: #5a6c7d;">üìâ –¢—Ä–µ–Ω–¥:</strong><br>‚Üó –†–∞—Å—Ç–µ—Ç (+12.3%)
                    </div>
                </div>
            </div>
        </div>
    `;
    
    const canvas = document.getElementById('militaryTensionCanvas');
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    const width = canvas.width;
    const height = canvas.height;
    const padding = 80;
    const chartWidth = width - 2 * padding;
    const chartHeight = height - 2 * padding;
    
    // –≠—Ç–∞–ª–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–æ–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
    const historicalData = [
        { date: new Date('2025-01-01'), value: 65 },
        { date: new Date('2025-01-02'), value: 68 },
        { date: new Date('2025-01-03'), value: 72 },
        { date: new Date('2025-01-04'), value: 75 },
        { date: new Date('2025-01-05'), value: 78 },
        { date: new Date('2025-01-06'), value: 82 },
        { date: new Date('2025-01-07'), value: 85 }
    ];
    
    const forecastData = [
        { date: new Date('2025-01-08'), value: 88 },
        { date: new Date('2025-01-09'), value: 91 },
        { date: new Date('2025-01-10'), value: 89 },
        { date: new Date('2025-01-11'), value: 87 },
        { date: new Date('2025-01-12'), value: 85 }
    ];
    
    const allData = [...historicalData, ...forecastData];
    
    // –ó–∞–ª–∏–≤–∫–∞ —Ñ–æ–Ω–∞
    ctx.fillStyle = '#ffffff';
    ctx.fillRect(0, 0, width, height);
    
    // –ó–∞–≥–æ–ª–æ–≤–æ–∫
    ctx.fillStyle = '#2c3e50';
    ctx.font = 'bold 20px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('–ò–Ω—Ç–µ–≥—Ä–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç–∏ - –í–æ–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏', width / 2, 35);
    
    // –†–∏—Å—É–µ–º —Å–µ—Ç–∫—É
    ctx.strokeStyle = 'rgba(0, 0, 0, 0.1)';
    ctx.lineWidth = 1;
    for (let i = 0; i <= 5; i++) {
        const y = padding + (chartHeight / 5) * i;
        ctx.beginPath();
        ctx.moveTo(padding, y);
        ctx.lineTo(width - padding, y);
        ctx.stroke();
        
        // –ü–æ–¥–ø–∏—Å–∏ –ø–æ Y
        ctx.fillStyle = '#2c3e50';
        ctx.font = 'bold 13px Arial';
        ctx.textAlign = 'right';
        ctx.fillText((100 - i * 20) + '%', padding - 15, y + 5);
    }
    
    // –†–∏—Å—É–µ–º –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
    ctx.strokeStyle = '#667eea';
    ctx.lineWidth = 3;
    ctx.beginPath();
    historicalData.forEach((point, index) => {
        const x = padding + (chartWidth / (allData.length - 1)) * index;
        const y = padding + chartHeight - (point.value / 100) * chartHeight;
        if (index === 0) {
            ctx.moveTo(x, y);
        } else {
            ctx.lineTo(x, y);
        }
    });
    ctx.stroke();
    
    // –†–∏—Å—É–µ–º —Ç–æ—á–∫–∏ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    historicalData.forEach((point, index) => {
        const x = padding + (chartWidth / (allData.length - 1)) * index;
        const y = padding + chartHeight - (point.value / 100) * chartHeight;
        
        ctx.fillStyle = '#667eea';
        ctx.beginPath();
        ctx.arc(x, y, 6, 0, 2 * Math.PI);
        ctx.fill();
        
        ctx.strokeStyle = '#ffffff';
        ctx.lineWidth = 2;
        ctx.stroke();
    });
    
    // –†–∏—Å—É–µ–º –ø—Ä–æ–≥–Ω–æ–∑–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    if (forecastData.length > 0) {
        ctx.strokeStyle = '#9b59b6';
        ctx.lineWidth = 3;
        ctx.setLineDash([8, 4]);
        ctx.beginPath();
        forecastData.forEach((point, index) => {
            const dataIndex = historicalData.length + index;
            const x = padding + (chartWidth / (allData.length - 1)) * dataIndex;
            const y = padding + chartHeight - (point.value / 100) * chartHeight;
            if (index === 0) {
                ctx.moveTo(x, y);
            } else {
                ctx.lineTo(x, y);
            }
        });
        ctx.stroke();
        ctx.setLineDash([]);
        
        // –†–∏—Å—É–µ–º —Ç–æ—á–∫–∏ –ø—Ä–æ–≥–Ω–æ–∑–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        forecastData.forEach((point, index) => {
            const dataIndex = historicalData.length + index;
            const x = padding + (chartWidth / (allData.length - 1)) * dataIndex;
            const y = padding + chartHeight - (point.value / 100) * chartHeight;
            
            ctx.fillStyle = '#9b59b6';
            ctx.beginPath();
            ctx.arc(x, y, 6, 0, 2 * Math.PI);
            ctx.fill();
            
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 2;
            ctx.stroke();
        });
    }
    
    // –õ–µ–≥–µ–Ω–¥–∞
    const legendX = width - 220;
    const legendY = 60;
    
    // –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
    ctx.strokeStyle = '#667eea';
    ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.moveTo(legendX, legendY + 5);
    ctx.lineTo(legendX + 30, legendY + 5);
    ctx.stroke();
    
    ctx.fillStyle = '#667eea';
    ctx.beginPath();
    ctx.arc(legendX + 15, legendY + 5, 5, 0, 2 * Math.PI);
    ctx.fill();
    
    ctx.fillStyle = '#2c3e50';
    ctx.font = 'bold 12px Arial';
    ctx.textAlign = 'left';
    ctx.fillText('–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ', legendX + 40, legendY + 10);
    
    // –ü—Ä–æ–≥–Ω–æ–∑
    ctx.strokeStyle = '#9b59b6';
    ctx.lineWidth = 4;
    ctx.setLineDash([8, 4]);
    ctx.beginPath();
    ctx.moveTo(legendX, legendY + 35);
    ctx.lineTo(legendX + 30, legendY + 35);
    ctx.stroke();
    ctx.setLineDash([]);
    
    ctx.fillStyle = '#9b59b6';
    ctx.beginPath();
    ctx.arc(legendX + 15, legendY + 35, 5, 0, 2 * Math.PI);
    ctx.fill();
    
    ctx.fillStyle = '#2c3e50';
    ctx.fillText('–ü—Ä–æ–≥–Ω–æ–∑ (5 –¥–Ω–µ–π)', legendX + 40, legendY + 40);
}

function loadMilitaryStatistics() {
    // –≠—Ç–∞–ª–æ–Ω–Ω—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–µ–º–æ-–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "–í–æ–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏"
    const totalNewsElement = document.getElementById('totalNews');
    const trendIndicatorElement = document.getElementById('trendIndicator');
    const socialActivityElement = document.getElementById('socialActivity');
    const newsVelocityElement = document.getElementById('newsVelocity');
    
    if (totalNewsElement) {
        totalNewsElement.textContent = '3,540';
    }
    
    if (trendIndicatorElement) {
        trendIndicatorElement.innerHTML = '<span class="trend-up">‚Üó –†–∞—Å—Ç–µ—Ç (+12.3%)</span>';
    }
    
    if (socialActivityElement) {
        socialActivityElement.textContent = '–í—ã—Å–æ–∫–∞—è';
    }
    
    if (newsVelocityElement) {
        newsVelocityElement.textContent = '78.5%';
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç–∏
    const distribution = {
        'critical': 15,
        'high': 25,
        'medium': 35,
        'low': 20,
        'minimal': 5
    };
    updateTensionDistribution(distribution);
}

function loadMilitaryNewsTable() {
    const container = document.getElementById('newsContainer');
    const dateRange = document.getElementById('dateRange').value;
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ –¥–ª—è –¥–µ–º–æ-–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —á–µ—Ä–µ–∑ API
    const apiUrl = `/api/ukraine_analytics/latest_news?category=military_operations&days=${dateRange}`;
    
    fetch(apiUrl)
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success' && data.news && data.news.length > 0) {
                // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                container.innerHTML = '';
                
                // –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
                const table = document.createElement('table');
                table.className = 'news-table';
                table.id = 'data-table';
                table.style.display = 'table';
                
                // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã
                const thead = document.createElement('thead');
                const headerRow = document.createElement('tr');
                headerRow.id = 'table-header';
                headerRow.innerHTML = `
                    <th class="date-col">–î–∞—Ç–∞</th>
                    <th class="title-col">–ó–∞–≥–æ–ª–æ–≤–æ–∫</th>
                    <th class="category-col">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                `;
                thead.appendChild(headerRow);
                table.appendChild(thead);
                
                // –¢–µ–ª–æ —Ç–∞–±–ª–∏—Ü—ã
                const tbody = document.createElement('tbody');
                tbody.id = 'table-body';
                
                data.news.forEach((news, index) => {
                    const row = document.createElement('tr');
                    row.classList.add('fade-in-up');
                    
                    row.innerHTML = `
                        <td class="date-col">${formatDate(news.date)}</td>
                        <td class="title-col" title="–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –ø–æ–ª–Ω—É—é —Å—Ç–∞—Ç—å—é" style="cursor: pointer;">${news.title}</td>
                        <td class="category-col">${getCategoryName(news.category)}</td>
                    `;
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ —Å—Ç—Ä–æ–∫—É
                    row.addEventListener('click', function() {
                        openNewsModal({
                            title: news.title,
                            date: formatDate(news.date),
                            source: news.source,
                            category: news.category,
                            categoryName: getCategoryName(news.category),
                            tension: news.tension ? news.tension.toFixed(1) : '0.0',
                            tensionColor: news.tension ? getTensionColorForValue(news.tension) : '#6c757d',
                            content: news.content || '–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ',
                            url: news.url || '#'
                        });
                    });
                    
                    tbody.appendChild(row);
                });
                
                table.appendChild(tbody);
                container.appendChild(table);
            } else {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–∞–Ω–Ω—ã—Ö
                container.innerHTML = `
                    <div class="alert alert-info text-center">
                        <i class="fas fa-info-circle"></i>
                        <h5>–ù–µ—Ç –Ω–æ–≤–æ—Å—Ç–µ–π –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</h5>
                        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ –ø–µ—Ä–∏–æ–¥ –≤—Ä–µ–º–µ–Ω–∏</p>
                    </div>
                `;
            }
        })
        .catch(error => {
            console.error('Error loading military news:', error);
            container.innerHTML = `
                <div class="alert alert-danger text-center">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h5>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–æ—Å—Ç–µ–π</h5>
                    <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</p>
                </div>
            `;
        });
}

function loadTestCharts(dateRange) {
    document.getElementById('territoryChart').innerHTML = `
        <div class="chart-placeholder">
            <canvas id="testTerritoryCanvas" width="700" height="450"></canvas>
                </div>
    `;
    
    // –†–∏—Å—É–µ–º —É–ª—É—á—à–µ–Ω–Ω—É—é –∫—Ä—É–≥–æ–≤—É—é –¥–∏–∞–≥—Ä–∞–º–º—É
    const canvas = document.getElementById('testTerritoryCanvas');
    if (canvas) {
        const ctx = canvas.getContext('2d');
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2 - 20;
        const radius = 130;
        
        const data = [
            { label: '–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π', value: 437, percent: 35, color: '#6c7b95' },
            { label: '–í–æ—Å—Ç–æ—á–Ω—ã–π', value: 312, percent: 25, color: '#8b9dc3' },
            { label: '–Æ–∂–Ω—ã–π', value: 249, percent: 20, color: '#a8b5c4' },
            { label: '–ó–∞–ø–∞–¥–Ω—ã–π', value: 249, percent: 20, color: '#c7d2da' }
        ];
        
        // –ó–∞–ª–∏–≤–∫–∞ —Ñ–æ–Ω–∞
        ctx.fillStyle = '#1e3a6a';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // –ó–∞–≥–æ–ª–æ–≤–æ–∫
        ctx.fillStyle = '#2c3e50';
        ctx.font = 'bold 18px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–µ–π –ø–æ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è–º - –í–æ–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏', centerX, 30);
        
        // –†–∏—Å—É–µ–º –∫—Ä—É–≥–æ–≤—É—é –¥–∏–∞–≥—Ä–∞–º–º—É —Å —Ç–µ–Ω—è–º–∏
        let currentAngle = -Math.PI / 2;
        data.forEach((item, index) => {
            const sliceAngle = (item.percent / 100) * 2 * Math.PI;
            
            // –¢–µ–Ω—å
            ctx.save();
            ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
            ctx.shadowBlur = 15;
            ctx.shadowOffsetX = 5;
            ctx.shadowOffsetY = 5;
            
            // –°–µ–∫—Ç–æ—Ä
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
            ctx.closePath();
            ctx.fillStyle = item.color;
            ctx.fill();
            ctx.restore();
            
            // –ë–µ–ª–∞—è –æ–±–≤–æ–¥–∫–∞
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 3;
            ctx.stroke();
            
            // –ü–æ–¥–ø–∏—Å–∏ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –≤–Ω—É—Ç—Ä–∏ —Å–µ–∫—Ç–æ—Ä–æ–≤
            const midAngle = currentAngle + sliceAngle / 2;
            const textX = centerX + Math.cos(midAngle) * (radius * 0.7);
            const textY = centerY + Math.sin(midAngle) * (radius * 0.7);
            
            ctx.fillStyle = '#2c3e50';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(item.percent + '%', textX, textY);
            
            currentAngle += sliceAngle;
        });
        
        // –õ–µ–≥–µ–Ω–¥–∞ —Å–Ω–∏–∑—É
        const legendY = centerY + radius + 50;
        const legendItemWidth = 140;
        const startX = (canvas.width - (legendItemWidth * 2)) / 2;
        
        data.forEach((item, index) => {
            const row = Math.floor(index / 2);
            const col = index % 2;
            const x = startX + col * legendItemWidth;
            const y = legendY + row * 30;
            
            // –¶–≤–µ—Ç–Ω–æ–π –∫–≤–∞–¥—Ä–∞—Ç
            ctx.fillStyle = item.color;
            ctx.fillRect(x, y - 10, 20, 20);
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 2;
            ctx.strokeRect(x, y - 10, 20, 20);
            
            // –¢–µ–∫—Å—Ç —Å –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏
            ctx.fillStyle = '#2c3e50';
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'left';
            ctx.textBaseline = 'middle';
            ctx.fillText(item.label + ' - ' + item.percent + '%', x + 28, y);
            ctx.font = '11px Arial';
            ctx.fillStyle = '#bbdefb';
            ctx.fillText(item.value + ' –Ω–æ–≤–æ—Å—Ç–µ–π', x + 28, y + 12);
        });
    }
    
    // –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ —Å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
    document.getElementById('sourcesChart').innerHTML = `
        <div class="chart-placeholder">
            <canvas id="testHeatmapCanvas" width="1200" height="550"></canvas>
        </div>
    `;
    
    // –†–∏—Å—É–µ–º —É–ª—É—á—à–µ–Ω–Ω—É—é —Ç–µ–ø–ª–æ–≤—É—é –∫–∞—Ä—Ç—É —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
    const heatCanvas = document.getElementById('testHeatmapCanvas');
    if (heatCanvas) {
        const ctx = heatCanvas.getContext('2d');
        const sources = [
            '–†–ò–ê –ù–æ–≤–æ—Å—Ç–∏', 'Lenta.ru', '–†–ë–ö', '–ì–∞–∑–µ—Ç–∞.ru', '–ö–æ–º–º–µ—Ä—Å–∞–Ω—Ç—ä', 
            'Reuters', 'CNN', 'BBC', 'Interfax', '–¢–ê–°–°'
        ];
        const days = ['–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞', '–°—É–±–±–æ—Ç–∞', '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ'];
        const cellWidth = 100;
        const cellHeight = 40;
        const startX = 160;
        const startY = 80;
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–æ–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
        const heatData = [
            [85, 92, 88, 95, 89, 45, 38],  // –†–ò–ê –ù–æ–≤–æ—Å—Ç–∏
            [78, 84, 79, 86, 82, 41, 35],  // Lenta.ru
            [82, 88, 85, 91, 87, 43, 37],  // –†–ë–ö
            [68, 75, 71, 78, 74, 32, 28],  // –ì–∞–∑–µ—Ç–∞.ru
            [71, 78, 74, 81, 77, 35, 30],  // –ö–æ–º–º–µ—Ä—Å–∞–Ω—Ç—ä
            [95, 98, 96, 99, 97, 55, 48],  // Reuters
            [98, 99, 97, 100, 98, 58, 51], // CNN
            [88, 91, 89, 93, 90, 48, 42],  // BBC
            [75, 81, 78, 84, 80, 38, 33],  // Interfax
            [90, 94, 92, 96, 93, 52, 45]   // –¢–ê–°–°
        ];
        
        // –ó–∞–ª–∏–≤–∫–∞ —Ñ–æ–Ω–∞
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0, 0, heatCanvas.width, heatCanvas.height);
        
        // –ó–∞–≥–æ–ª–æ–≤–æ–∫
        ctx.fillStyle = '#2c3e50';
        ctx.font = 'bold 20px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏–π –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º –∑–∞ –Ω–µ–¥–µ–ª—é - –í–æ–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏', heatCanvas.width / 2, 35);
        
        // –†–∏—Å—É–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–Ω–µ–π
        ctx.font = 'bold 11px Arial';
        ctx.fillStyle = '#2c3e50';
        ctx.textAlign = 'center';
        days.forEach((day, i) => {
            ctx.fillText(day, startX + i * cellWidth + cellWidth / 2, startY - 20);
        });
        
        // –†–∏—Å—É–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∏ —è—á–µ–π–∫–∏
        sources.forEach((source, i) => {
            // –ù–∞–∑–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
            ctx.fillStyle = '#2c3e50';
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'right';
            ctx.textBaseline = 'middle';
            ctx.fillText(source, startX - 10, startY + i * cellHeight + cellHeight / 2);
            
            days.forEach((day, j) => {
                const value = heatData[i][j];
                
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç –ø–æ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏ (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Å—Ö–µ–º–∞ –¥–ª—è –∑–Ω–∞—á–µ–Ω–∏–π –¥–æ 100)
            let color;
            if (value < 40) color = '#e8f5e8';      // –û—á–µ–Ω—å –Ω–∏–∑–∫–∞—è
            else if (value < 60) color = '#fff3cd';  // –ù–∏–∑–∫–∞—è
            else if (value < 80) color = '#ffeaa7';  // –°—Ä–µ–¥–Ω—è—è
            else if (value < 90) color = '#fab1a0';  // –í—ã—Å–æ–∫–∞—è
            else color = '#e17055';                  // –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è
                
                // –†–∏—Å—É–µ–º —è—á–µ–π–∫—É —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º
                const gradient = ctx.createLinearGradient(
                    startX + j * cellWidth, 
                    startY + i * cellHeight,
                    startX + j * cellWidth + cellWidth - 4, 
                    startY + i * cellHeight + cellHeight - 4
                );
                gradient.addColorStop(0, color);
                gradient.addColorStop(1, shadeColor(color, -20));
                
                ctx.fillStyle = gradient;
                ctx.fillRect(
                    startX + j * cellWidth, 
                    startY + i * cellHeight, 
                    cellWidth - 4, 
                    cellHeight - 4
                );
                
                // –ë–µ–ª–∞—è —Ä–∞–º–∫–∞
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 2;
                ctx.strokeRect(
                    startX + j * cellWidth, 
                    startY + i * cellHeight, 
                    cellWidth - 4, 
                    cellHeight - 4
                );
                
                // –ó–Ω–∞—á–µ–Ω–∏–µ –≤ —è—á–µ–π–∫–µ
                ctx.fillStyle = '#2c3e50';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(
                    value, 
                    startX + j * cellWidth + (cellWidth - 4) / 2, 
                    startY + i * cellHeight + (cellHeight - 4) / 2
                );
            });
        });
        
        // –õ–µ–≥–µ–Ω–¥–∞
        const legendY = startY + sources.length * cellHeight + 30;
        const legendX = startX;
        
        ctx.font = 'bold 12px Arial';
        ctx.fillStyle = '#2c3e50';
        ctx.textAlign = 'left';
        ctx.fillText('–£—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:', legendX, legendY);
        
        const legendItems = [
            { label: '–ù–∏–∑–∫–∞—è (0-29)', color: '#7fb069' },
            { label: '–£–º–µ—Ä–µ–Ω–Ω–∞—è (30-49)', color: '#b5a565' },
            { label: '–°—Ä–µ–¥–Ω—è—è (50-69)', color: '#d4a574' },
            { label: '–í—ã—Å–æ–∫–∞—è (70+)', color: '#c77d6a' }
        ];
        
        legendItems.forEach((item, i) => {
            const x = legendX + i * 130;
            const y = legendY + 20;
            
            // –¶–≤–µ—Ç–Ω–æ–π –∫–≤–∞–¥—Ä–∞—Ç
            ctx.fillStyle = item.color;
            ctx.fillRect(x, y - 10, 20, 20);
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 2;
            ctx.strokeRect(x, y - 10, 20, 20);
            
            // –¢–µ–∫—Å—Ç
            ctx.fillStyle = '#2c3e50';
            ctx.font = '11px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(item.label, x + 25, y + 2);
        });
    }
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞—Ç–µ–º–Ω–µ–Ω–∏—è —Ü–≤–µ—Ç–∞
function shadeColor(color, percent) {
    const num = parseInt(color.replace('#', ''), 16);
    const amt = Math.round(2.55 * percent);
    const R = (num >> 16) + amt;
    const G = (num >> 8 & 0x00FF) + amt;
    const B = (num & 0x0000FF) + amt;
    return '#' + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
        (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
        (B < 255 ? B < 1 ? 0 : B : 255))
        .toString(16).slice(1);
}

function loadRealCharts(category, dateRange) {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫—Ä—É–≥–æ–≤–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã –ø–æ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è–º
    fetch(`/api/ukraine_analytics/territory_data?days=${dateRange}&category=${category}`)
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success' && data.data.length > 0) {
                createRealTerritoryChart(data.data, data.total_news);
            } else {
                document.getElementById('territoryChart').innerHTML = `
                    <div class="alert alert-info">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
                `;
            }
        })
        .catch(error => {
            console.error('Error loading territory data:', error);
            document.getElementById('territoryChart').innerHTML = `
                <div class="alert alert-danger">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</div>
            `;
        });
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ–ø–ª–æ–≤–æ–π –∫–∞—Ä—Ç—ã
    fetch(`/api/ukraine_analytics/heatmap_data?days=${dateRange}&category=${category}`)
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success' && data.data.length > 0) {
                createRealHeatmap(data.sources, data.days, data.data);
            } else {
                document.getElementById('sourcesChart').innerHTML = `
                    <div class="alert alert-info">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–ø–ª–æ–≤–æ–π –∫–∞—Ä—Ç—ã</div>
                `;
            }
        })
        .catch(error => {
            console.error('Error loading heatmap data:', error);
            document.getElementById('sourcesChart').innerHTML = `
                <div class="alert alert-danger">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–ø–ª–æ–≤–æ–π –∫–∞—Ä—Ç—ã</div>
            `;
        });
}

function createRealCategoryChart(data, totalNews) {
    // –°–æ–∑–¥–∞–µ–º Canvas –¥–ª—è –∫—Ä—É–≥–æ–≤–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã
    document.getElementById('categoryChart').innerHTML = `
        <div class="chart-placeholder">
            <canvas id="realCategoryCanvas" width="700" height="450"></canvas>
            </div>
    `;
    
    const canvas = document.getElementById('realCategoryCanvas');
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2 - 20;
    const radius = 130;
    
    // –ó–∞–ª–∏–≤–∫–∞ —Ñ–æ–Ω–∞
    ctx.fillStyle = '#ffffff';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // –ó–∞–≥–æ–ª–æ–≤–æ–∫
    ctx.fillStyle = '#2c3e50';
    ctx.font = 'bold 18px Arial';
    ctx.textAlign = 'center';
    ctx.fillText(`–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–µ–π –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (${totalNews.toLocaleString()} –≤—Å–µ–≥–æ)`, centerX, 30);
    
    // –†–∏—Å—É–µ–º –∫—Ä—É–≥–æ–≤—É—é –¥–∏–∞–≥—Ä–∞–º–º—É
    let currentAngle = -Math.PI / 2;
    data.forEach((item, index) => {
        const sliceAngle = (item.percent / 100) * 2 * Math.PI;
        
        // –¢–µ–Ω—å
        ctx.save();
        ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
        ctx.shadowBlur = 15;
        ctx.shadowOffsetX = 5;
        ctx.shadowOffsetY = 5;
        
        // –°–µ–∫—Ç–æ—Ä
        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
        ctx.closePath();
        ctx.fillStyle = item.color;
        ctx.fill();
        ctx.restore();
        
        // –ë–µ–ª–∞—è –æ–±–≤–æ–¥–∫–∞
        ctx.strokeStyle = '#ffffff';
        ctx.lineWidth = 3;
        ctx.stroke();
        
        // –£–±–∏—Ä–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç—ã —Å –¥–∏–∞–≥—Ä–∞–º–º—ã - –æ–Ω–∏ –±—É–¥—É—Ç –≤ –ª–µ–≥–µ–Ω–¥–µ
        
        currentAngle += sliceAngle;
    });
    
    // –õ–µ–≥–µ–Ω–¥–∞ —Å–Ω–∏–∑—É
    const legendY = centerY + radius + 50;
    const legendItemWidth = 140;
    const startX = (canvas.width - (legendItemWidth * 2)) / 2;
    
    data.forEach((item, index) => {
        const row = Math.floor(index / 2);
        const col = index % 2;
        const x = startX + col * legendItemWidth;
        const y = legendY + row * 30;
        
        // –¶–≤–µ—Ç–Ω–æ–π –∫–≤–∞–¥—Ä–∞—Ç
        ctx.fillStyle = item.color;
        ctx.fillRect(x, y - 10, 20, 20);
        ctx.strokeStyle = '#ffffff';
        ctx.lineWidth = 2;
        ctx.strokeRect(x, y - 10, 20, 20);
        
        // –¢–µ–∫—Å—Ç
        ctx.fillStyle = '#2c3e50';
        ctx.font = 'bold 12px Arial';
        ctx.textAlign = 'left';
        ctx.textBaseline = 'middle';
        ctx.fillText(item.name, x + 28, y);
        ctx.font = '11px Arial';
        ctx.fillStyle = '#6c757d';
        ctx.fillText(item.count.toLocaleString() + ' –Ω–æ–≤–æ—Å—Ç–µ–π', x + 28, y + 12);
    });
}

function createRealTerritoryChart(data, totalNews) {
    // –°–æ–∑–¥–∞–µ–º Canvas –¥–ª—è –∫—Ä—É–≥–æ–≤–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã –ø–æ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è–º
    document.getElementById('territoryChart').innerHTML = `
        <div class="chart-placeholder">
            <canvas id="realTerritoryCanvas" width="700" height="450"></canvas>
        </div>
    `;
    
    const canvas = document.getElementById('realTerritoryCanvas');
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2 - 20;
    const radius = 130;
    
    // –ó–∞–ª–∏–≤–∫–∞ —Ñ–æ–Ω–∞
    ctx.fillStyle = '#ffffff';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // –ó–∞–≥–æ–ª–æ–≤–æ–∫
    ctx.fillStyle = '#2c3e50';
    ctx.font = 'bold 18px Arial';
    ctx.textAlign = 'center';
    ctx.fillText(`–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–µ–π –ø–æ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è–º (${totalNews.toLocaleString()} –≤—Å–µ–≥–æ)`, centerX, 30);
    
    // –†–∏—Å—É–µ–º –∫—Ä—É–≥–æ–≤—É—é –¥–∏–∞–≥—Ä–∞–º–º—É
    let currentAngle = -Math.PI / 2;
    data.forEach((item, index) => {
        const sliceAngle = (item.percent / 100) * 2 * Math.PI;
        
        // –¢–µ–Ω—å
        ctx.save();
        ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
        ctx.shadowBlur = 15;
        ctx.shadowOffsetX = 5;
        ctx.shadowOffsetY = 5;
        
        // –°–µ–∫—Ç–æ—Ä
        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
        ctx.closePath();
        ctx.fillStyle = item.color;
        ctx.fill();
        ctx.restore();
        
        // –ë–µ–ª–∞—è –æ–±–≤–æ–¥–∫–∞
        ctx.strokeStyle = '#ffffff';
        ctx.lineWidth = 3;
        ctx.stroke();
        
        // –£–±–∏—Ä–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç—ã —Å –¥–∏–∞–≥—Ä–∞–º–º—ã - –æ–Ω–∏ –±—É–¥—É—Ç –≤ –ª–µ–≥–µ–Ω–¥–µ
        
        currentAngle += sliceAngle;
    });
    
    // –õ–µ–≥–µ–Ω–¥–∞ —Å–Ω–∏–∑—É
    const legendY = centerY + radius + 50;
    const legendItemWidth = 180;  // –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 140 –¥–æ 180
    const startX = (canvas.width - (legendItemWidth * 2)) / 2;
    
    data.forEach((item, index) => {
        const row = Math.floor(index / 2);
        const col = index % 2;
        const x = startX + col * legendItemWidth;
        const y = legendY + row * 35;  // –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 30 –¥–æ 35
        
        // –¶–≤–µ—Ç–Ω–æ–π –∫–≤–∞–¥—Ä–∞—Ç
        ctx.fillStyle = item.color;
        ctx.fillRect(x, y - 10, 20, 20);
        ctx.strokeStyle = '#ffffff';
        ctx.lineWidth = 2;
        ctx.strokeRect(x, y - 10, 20, 20);
        
        // –¢–µ–∫—Å—Ç —Å –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏
        ctx.fillStyle = '#2c3e50';
        ctx.font = 'bold 12px Arial';
        ctx.textAlign = 'left';
        ctx.textBaseline = 'middle';
        ctx.fillText(item.territory + ' - ' + item.percent + '%', x + 28, y);
        ctx.font = '11px Arial';
        ctx.fillStyle = '#6c757d';
        ctx.fillText(item.count.toLocaleString() + ' –Ω–æ–≤–æ—Å—Ç–µ–π', x + 28, y + 12);
    });
}

function createRealHeatmap(sources, days, data) {
    // –°–æ–∑–¥–∞–µ–º Canvas –¥–ª—è —Ç–µ–ø–ª–æ–≤–æ–π –∫–∞—Ä—Ç—ã —Å –∫–æ–º–ø–∞–∫—Ç–Ω—ã–º —Ä–∞–∑–º–µ—Ä–æ–º
    const canvasWidth = Math.max(900, days.length * 70 + 200);
    const canvasHeight = Math.max(400, sources.length * 35 + 120);
    document.getElementById('sourcesChart').innerHTML = `
        <div class="chart-placeholder">
            <canvas id="realHeatmapCanvas" width="${canvasWidth}" height="${canvasHeight}"></canvas>
        </div>
    `;
    
    const canvas = document.getElementById('realHeatmapCanvas');
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    const cellWidth = Math.max(60, (canvasWidth - 200) / days.length);
    const cellHeight = Math.max(30, (canvasHeight - 120) / sources.length);
    const startX = 140;
    const startY = 80;
    
    // –ó–∞–ª–∏–≤–∫–∞ —Ñ–æ–Ω–∞
    ctx.fillStyle = '#ffffff';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // –ó–∞–≥–æ–ª–æ–≤–æ–∫
    ctx.fillStyle = '#2c3e50';
    ctx.font = 'bold 18px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏–π –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º –∑–∞ –Ω–µ–¥–µ–ª—é', canvas.width / 2, 30);
    
    // –†–∏—Å—É–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–Ω–µ–π
    ctx.font = 'bold 12px Arial';
    ctx.fillStyle = '#2c3e50';
    ctx.textAlign = 'center';
    days.forEach((day, i) => {
        ctx.fillText(day, startX + i * cellWidth + cellWidth / 2, startY - 20);
    });
    
    // –†–∏—Å—É–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∏ —è—á–µ–π–∫–∏
    sources.forEach((source, i) => {
        // –ù–∞–∑–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
        ctx.fillStyle = '#2c3e50';
        ctx.font = 'bold 12px Arial';
        ctx.textAlign = 'right';
        ctx.textBaseline = 'middle';
        ctx.fillText(source, startX - 10, startY + i * cellHeight + cellHeight / 2);
        
        days.forEach((day, j) => {
            const value = data[i][j];
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç –ø–æ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏
            let color;
            if (value < 5) color = '#2ecc71';
            else if (value < 15) color = '#f1c40f';
            else if (value < 30) color = '#f39c12';
            else color = '#e74c3c';
            
            // –†–∏—Å—É–µ–º —è—á–µ–π–∫—É —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º
            const gradient = ctx.createLinearGradient(
                startX + j * cellWidth, 
                startY + i * cellHeight,
                startX + j * cellWidth + cellWidth - 4, 
                startY + i * cellHeight + cellHeight - 4
            );
            gradient.addColorStop(0, color);
            gradient.addColorStop(1, shadeColor(color, -20));
            
            ctx.fillStyle = gradient;
            ctx.fillRect(
                startX + j * cellWidth, 
                startY + i * cellHeight, 
                cellWidth - 4, 
                cellHeight - 4
            );
            
            // –ë–µ–ª–∞—è —Ä–∞–º–∫–∞
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 2;
            ctx.strokeRect(
                startX + j * cellWidth, 
                startY + i * cellHeight, 
                cellWidth - 4, 
                cellHeight - 4
            );
            
            // –ó–Ω–∞—á–µ–Ω–∏–µ –≤ —è—á–µ–π–∫–µ
            ctx.fillStyle = '#2c3e50';
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(value.toString(), 
                startX + j * cellWidth + cellWidth / 2, 
                startY + i * cellHeight + cellHeight / 2);
        });
    });
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ –Ω–æ–≤–æ—Å—Ç–µ–π
function renderNewsCards(newsData, container) {
    newsData.forEach(news => {
        const isTestCategory = news.category && news.category.startsWith('test_');
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç–∏ –∏–∑ API, –µ—Å–ª–∏ –Ω–µ—Ç - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ù/–î
        const tensionScore = news.tension_index || news.tension_score || news.tension || '–ù/–î';
        const spikeScore = news.spike_index || news.spike_score || news.spike || '–ù/–î';
        
        const newsCard = document.createElement('div');
        newsCard.className = 'news-card';
        newsCard.style.cursor = 'pointer';
        newsCard.innerHTML = `
            <div class="news-card-body">
                <div class="news-title">
                    <a href="${news.url || news.link || '#'}" target="_blank">${news.title}</a>
                </div>
                ${news.content ? `<div class="news-content">${news.content.substring(0, 150)}...</div>` : ''}
                <div class="news-meta">
                    <div class="news-meta-item">
                        <i class="fas fa-clock"></i>
                        <span class="news-time">${formatDate(news.published_date || news.date)}</span>
                    </div>
                    <div class="news-meta-item">
                        <i class="fas fa-tag"></i>
                        <span class="news-category">${getCategoryName(news.category)}</span>
                    </div>
                    <div class="news-meta-item">
                        <i class="fas fa-thermometer-half"></i>
                        <span class="news-tension">${tensionScore === '–ù/–î' ? '–ù/–î' : tensionScore.toFixed(1) + '%'}</span>
                    </div>
                    <div class="news-meta-item">
                        <i class="fas fa-chart-line"></i>
                        <span class="news-spike">${spikeScore === '–ù/–î' ? '–ù/–î' : spikeScore.toFixed(1) + '%'}</span>
                    </div>
                    <div class="news-meta-item">
                        <i class="fas fa-rss"></i>
                        <span class="news-source">${news.source}</span>
                    </div>
                </div>
            </div>
        `;
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        newsCard.addEventListener('click', function(e) {
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –æ—Ç–∫—Ä—ã—Ç–∏–µ —Å—Å—ã–ª–∫–∏ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É
            e.preventDefault();
            
            // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –¥–∞–Ω–Ω—ã–º–∏ –Ω–æ–≤–æ—Å—Ç–∏
            openNewsModal({
                title: news.title,
                date: formatDate(news.published_date || news.date),
                source: news.source,
                category: news.category,
                categoryName: getCategoryName(news.category),
                tension: tensionScore === '–ù/–î' ? '–ù/–î' : tensionScore.toFixed(1),
                tensionColor: tensionScore === '–ù/–î' ? '#6c757d' : getTensionColorForValue(tensionScore),
                content: news.content || '–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–ª—è —á—Ç–µ–Ω–∏—è.',
                url: news.url || news.link || '#'
            });
        });
        
        container.appendChild(newsCard);
    });
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –Ω–æ–≤–æ—Å—Ç–µ–π
function showNoNewsMessage(container) {
    container.innerHTML = `
        <div class="no-news">
            <i class="fas fa-inbox"></i>
            <h5>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</h5>
            <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ –ø–µ—Ä–∏–æ–¥ –≤—Ä–µ–º–µ–Ω–∏</p>
        </div>
    `;
}

function loadNewsTable(category, dateRange) {
    const container = document.getElementById('newsContainer');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π "–í–æ–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏"
    if (category === 'military_operations_demo') {
        loadMilitaryNewsTable();
        return;
    }
    
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API —ç–Ω–¥–ø–æ–∏–Ω—Ç —Å —É—á–µ—Ç–æ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    let apiUrl = '/api/ukraine_analytics/latest_news?category=all&days=' + dateRange;
    if (category !== 'all') {
        // –î–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–π API —ç–Ω–¥–ø–æ–∏–Ω—Ç latest_news
        apiUrl = `/api/ukraine_analytics/latest_news?category=${category}&days=${dateRange}`;
    }
    
    console.log('Loading news for category:', category, 'API URL:', apiUrl);
    
    fetch(apiUrl)
        .then(response => response.json())
        .then(data => {
            console.log('News API response:', data);
            let newsData = [];
            
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
            if (data.latest_news && Array.isArray(data.latest_news)) {
                newsData = data.latest_news;
            } else if (data.data && Array.isArray(data.data)) {
                newsData = data.data;
            } else if (data.news && Array.isArray(data.news)) {
                newsData = data.news;
            } else if (Array.isArray(data)) {
                newsData = data;
            }
            
            container.innerHTML = '';
            
            if (newsData.length === 0) {
                // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–æ–º –∏—Å—Ç–æ—á–Ω–∏–∫–µ, –ø–æ–ø—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ –Ω–æ–≤–æ—Å—Ç–∏
                if (category !== 'all' && !apiUrl.includes('source=all')) {
                    console.log('No data in specific source, trying all news...');
                    fetch('/api/news?limit=20')
                        .then(response => response.json())
                        .then(fallbackData => {
                            console.log('Fallback news response:', fallbackData);
                            if (fallbackData.data && fallbackData.data.length > 0) {
                                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–æ–≤–æ—Å—Ç–∏ —Å –ø–æ–º–µ—Ç–∫–æ–π
                                container.innerHTML = `
                                    <div class="alert alert-info mb-3">
                                        <i class="fas fa-info-circle"></i>
                                        –ù–æ–≤–æ—Å—Ç–∏ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${getCategoryName(category)}" –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–∫–∞–∑–∞–Ω—ã –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏:
                                    </div>
                                `;
                                renderNewsCards(fallbackData.data, container);
                            } else {
                                showNoNewsMessage(container);
                            }
                        })
                        .catch(error => {
                            console.error('Error loading fallback news:', error);
                            showNoNewsMessage(container);
                        });
                    return;
                } else {
                    showNoNewsMessage(container);
                    return;
                }
            }
            
            renderNewsCards(newsData, container);
        })
        .catch(error => {
            console.error('Error loading news table:', error);
            container.innerHTML = `
                <div class="no-news">
                    <i class="fas fa-exclamation-triangle text-danger"></i>
                    <h5>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</h5>
                    <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</p>
                </div>
            `;
        });
}


function loadTestNewsTable(tbody) {
    const testNews = [
        {
            date: new Date(Date.now() - 1000 * 60 * 30),
            title: '–£—Å–ø–µ—à–Ω–æ–µ –∫–æ–Ω—Ç—Ä–Ω–∞—Å—Ç—É–ø–ª–µ–Ω–∏–µ –≤ –≤–æ—Å—Ç–æ—á–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏: –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω—ã —Ç—Ä–∏ –Ω–∞—Å–µ–ª–µ–Ω–Ω—ã—Ö –ø—É–Ω–∫—Ç–∞',
            content: '–ü–æ –¥–∞–Ω–Ω—ã–º –ì–µ–Ω—à—Ç–∞–±–∞, –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –í–°–£ –æ—Å–≤–æ–±–æ–¥–∏–ª–∏ —Ç—Ä–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã—Ö –Ω–∞—Å–µ–ª–µ–Ω–Ω—ã—Ö –ø—É–Ω–∫—Ç–∞ –≤ –≤–æ—Å—Ç–æ—á–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏. –û–ø–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–æ–¥–∏–ª–∞—Å—å –≤ —Ç–µ—á–µ–Ω–∏–µ 48 —á–∞—Å–æ–≤ —Å –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ–º –º–µ—Ö–∞–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π –∏ –∞—Ä—Ç–∏–ª–ª–µ—Ä–∏–∏. –ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ –ø–æ–Ω–µ—Å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ—Ç–µ—Ä–∏ –≤ –∂–∏–≤–æ–π —Å–∏–ª–µ –∏ —Ç–µ—Ö–Ω–∏–∫–µ. –ú–µ—Å—Ç–Ω—ã–µ –∂–∏—Ç–µ–ª–∏ –≤—Å—Ç—Ä–µ—á–∞—é—Ç —É–∫—Ä–∞–∏–Ω—Å–∫–∏—Ö –≤–æ–µ–Ω–Ω—ã—Ö —Å —Ü–≤–µ—Ç–∞–º–∏ –∏ —Å–ª–µ–∑–∞–º–∏ —Ä–∞–¥–æ—Å—Ç–∏. –ö–æ–º–∞–Ω–¥–æ–≤–∞–Ω–∏–µ –æ—Ç–º–µ—á–∞–µ—Ç –≤—ã—Å–æ–∫–∏–π –º–æ—Ä–∞–ª—å–Ω—ã–π –¥—É—Ö –±–æ–π—Ü–æ–≤ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–æ–≤–æ–π —Ç–∞–∫—Ç–∏–∫–∏ –≤–µ–¥–µ–Ω–∏—è –±–æ–µ–≤—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π.',
            source: '–†–ò–ê –ù–æ–≤–æ—Å—Ç–∏',
            tension: 82.4
        },
        {
            date: new Date(Date.now() - 1000 * 60 * 90),
            title: '–ü–æ—Å—Ç–∞–≤–∫–∞ –Ω–æ–≤–æ–π –ø–∞—Ä—Ç–∏–∏ –≤–æ–µ–Ω–Ω–æ–π —Ç–µ—Ö–Ω–∏–∫–∏ –∏–∑ —Å—Ç—Ä–∞–Ω –ù–ê–¢–û',
            content: '–ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ –æ–±–æ—Ä–æ–Ω—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–æ –ø–æ–ª—É—á–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥–Ω–æ–π –ø–∞—Ä—Ç–∏–∏ –±—Ä–æ–Ω–µ—Ç–µ—Ö–Ω–∏–∫–∏ –∏ —Å–∏—Å—Ç–µ–º –ü–í–û –æ—Ç —Å–æ—é–∑–Ω–∏–∫–æ–≤ –ø–æ –ù–ê–¢–û. –í –ø–æ—Å—Ç–∞–≤–∫—É –≤–æ—à–ª–∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–Ω–∫–∏, –ë–ú–ü –∏ –∑–µ–Ω–∏—Ç–Ω–æ-—Ä–∞–∫–µ—Ç–Ω—ã–µ –∫–æ–º–ø–ª–µ–∫—Å—ã –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è. –¢–µ—Ö–Ω–∏–∫–∞ —É–∂–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç –∞–¥–∞–ø—Ç–∞—Ü–∏—é –¥–ª—è —É–∫—Ä–∞–∏–Ω—Å–∫–∏—Ö —ç–∫–∏–ø–∞–∂–µ–π –Ω–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –ø–æ–ª–∏–≥–æ–Ω–∞—Ö. –≠–∫—Å–ø–µ—Ä—Ç—ã –æ—Ç–º–µ—á–∞—é—Ç, —á—Ç–æ –Ω–æ–≤–æ–µ –≤–æ–æ—Ä—É–∂–µ–Ω–∏–µ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É—Å–∏–ª–∏—Ç –æ–±–æ—Ä–æ–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É–∫—Ä–∞–∏–Ω—Å–∫–æ–π –∞—Ä–º–∏–∏ –∏ –ø–æ–∑–≤–æ–ª–∏—Ç –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –ø—Ä–æ—Ç–∏–≤–æ—Å—Ç–æ—è—Ç—å –≤–æ–∑–¥—É—à–Ω—ã–º –∞—Ç–∞–∫–∞–º –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞.',
            source: 'Reuters',
            tension: 54.2
        },
        {
            date: new Date(Date.now() - 1000 * 60 * 150),
            title: '–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–µ –±–æ–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç—Å—è –≤ —Ä–∞–π–æ–Ω–µ –ë–∞—Ö–º—É—Ç–∞',
            content: '–í–æ–µ–Ω–Ω—ã–µ —ç–∫—Å–ø–µ—Ä—Ç—ã —Å–æ–æ–±—â–∞—é—Ç –æ –ø—Ä–æ–¥–æ–ª–∂–∞—é—â–∏—Ö—Å—è –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã—Ö –±–æ–µ–≤—ã—Ö –¥–µ–π—Å—Ç–≤–∏—è—Ö –≤ —Ä–∞–π–æ–Ω–µ –ë–∞—Ö–º—É—Ç–∞. –û–±–µ —Å—Ç–æ—Ä–æ–Ω—ã –Ω–µ—Å—É—Ç –ø–æ—Ç–µ—Ä–∏ –≤ –∂–∏–≤–æ–π —Å–∏–ª–µ –∏ —Ç–µ—Ö–Ω–∏–∫–µ. –£–∫—Ä–∞–∏–Ω—Å–∫–∏–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —É–¥–µ—Ä–∂–∏–≤–∞—é—Ç –∫–ª—é—á–µ–≤—ã–µ –≤—ã—Å–æ—Ç—ã –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏. –ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–æ—Ä—ã–≤–∞ –æ–±–æ—Ä–æ–Ω—ã, –æ–¥–Ω–∞–∫–æ –≤—Å–µ –∞—Ç–∞–∫–∏ –æ—Ç—Ä–∞–∂–∞—é—Ç—Å—è —Å –±–æ–ª—å—à–∏–º–∏ –¥–ª—è –Ω–µ–≥–æ –ø–æ—Ç–µ—Ä—è–º–∏. –ì—Ä–∞–∂–¥–∞–Ω—Å–∫–æ–µ –Ω–∞—Å–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —ç–≤–∞–∫—É–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏–∑ –∑–æ–Ω—ã –∞–∫—Ç–∏–≤–Ω—ã—Ö –±–æ–µ–≤—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π. –ì—É–º–∞–Ω–∏—Ç–∞—Ä–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è –≤ –≥–æ—Ä–æ–¥–µ –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ–π.',
            source: 'CNN',
            tension: 91.7
        },
        {
            date: new Date(Date.now() - 1000 * 60 * 240),
            title: '–ù–æ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –≤–µ–¥–µ–Ω–∏—è –±–æ–µ–≤—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å',
            content: '–í–æ–µ–Ω–Ω—ã–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –æ—Ç–º–µ—á–∞—é—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∞–∫—Ç–∏–∫–∏ —É–∫—Ä–∞–∏–Ω—Å–∫–∏—Ö –≤–æ–π—Å–∫, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ. –ù–æ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç –±–æ–ª–µ–µ –≥–∏–±–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–æ–≤, –∞–∫—Ç–∏–≤–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –±–µ—Å–ø–∏–ª–æ—Ç–Ω–∏–∫–æ–≤ –¥–ª—è —Ä–∞–∑–≤–µ–¥–∫–∏ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –æ–≥–Ω—è, –∞ —Ç–∞–∫–∂–µ —É–ª—É—á—à–µ–Ω–Ω—É—é –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—é –º–µ–∂–¥—É —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ä–æ–¥–∞–º–∏ –≤–æ–π—Å–∫. –ó–∞–ø–∞–¥–Ω—ã–µ –≤–æ–µ–Ω–Ω—ã–µ —ç–∫—Å–ø–µ—Ä—Ç—ã –≤—ã—Å–æ–∫–æ –æ—Ü–µ–Ω–∏–≤–∞—é—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å —É–∫—Ä–∞–∏–Ω—Å–∫–æ–≥–æ –∫–æ–º–∞–Ω–¥–æ–≤–∞–Ω–∏—è –∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –±—ã—Å—Ç—Ä–æ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –∏–∑–º–µ–Ω—è—é—â—É—é—Å—è –æ–±—Å—Ç–∞–Ω–æ–≤–∫—É –Ω–∞ –ø–æ–ª–µ –±–æ—è.',
            source: '–õ–µ–Ω—Ç–∞.—Ä—É',
            tension: 45.8
        },
        {
            date: new Date(Date.now() - 1000 * 60 * 360),
            title: '–û–±—ä—è–≤–ª–µ–Ω–∞ —á–∞—Å—Ç–∏—á–Ω–∞—è –º–æ–±–∏–ª–∏–∑–∞—Ü–∏—è –≤ —Ç—Ä–µ—Ö –æ–±–ª–∞—Å—Ç—è—Ö',
            content: '–ü—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–æ –ø—Ä–∏–Ω—è–ª–æ —Ä–µ—à–µ–Ω–∏–µ –æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–∏ —á–∞—Å—Ç–∏—á–Ω–æ–π –º–æ–±–∏–ª–∏–∑–∞—Ü–∏–∏ –≤ –ø—Ä–∏–≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–∞—Ö –¥–ª—è —É—Å–∏–ª–µ–Ω–∏—è –æ–±–æ—Ä–æ–Ω—ã. –ü—Ä–∏–∑—ã–≤—É –ø–æ–¥–ª–µ–∂–∞—Ç –≥—Ä–∞–∂–¥–∞–Ω–µ —Å –≤–æ–µ–Ω–Ω—ã–º –æ–ø—ã—Ç–æ–º –≤ –≤–æ–∑—Ä–∞—Å—Ç–µ –æ—Ç 25 –¥–æ 45 –ª–µ—Ç. –°–æ–∑–¥–∞—é—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—á–µ–±–Ω—ã–µ —Ü–µ–Ω—Ç—Ä—ã –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –º–æ–±–∏–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö. –ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ –æ–±–æ—Ä–æ–Ω—ã –∑–∞–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –≤—Å–µ –ø—Ä–∏–∑–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–∞—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –æ–±–º—É–Ω–¥–∏—Ä–æ–≤–∞–Ω–∏–µ, –≤–æ–æ—Ä—É–∂–µ–Ω–∏–µ –∏ –ø—Ä–æ–π–¥—É—Ç –ø–æ–ª–Ω—ã–π –∫—É—Ä—Å –±–æ–µ–≤–æ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ –∑–æ–Ω—É –±–æ–µ–≤—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π. –°–µ–º—å—è–º –º–æ–±–∏–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –±—É–¥–µ—Ç –æ–∫–∞–∑–∞–Ω–∞ —Å–æ—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞.',
            source: '–†–ë–ö',
            tension: 76.3
        },
        {
            date: new Date(Date.now() - 1000 * 60 * 480),
            title: '–î–∏–ø–ª–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã: –≤–æ–∑–º–æ–∂–µ–Ω –ø—Ä–æ—Ä—ã–≤ –≤ –±–ª–∏–∂–∞–π—à–∏–µ –Ω–µ–¥–µ–ª–∏',
            content: '–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –≤ –ú–ò–î —Å–æ–æ–±—â–∞—é—Ç –æ –ø–æ–∑–∏—Ç–∏–≤–Ω—ã—Ö —Å–¥–≤–∏–≥–∞—Ö –≤ –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–Ω–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ. –°—Ç–æ—Ä–æ–Ω—ã –≥–æ—Ç–æ–≤—ã –∫ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å–∞–º –ø–æ —Ä—è–¥—É –∫–ª—é—á–µ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤. –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ –ø–æ—Å—Ä–µ–¥–Ω–∏–∫–∏ –æ—Ç–º–µ—á–∞—é—Ç –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã–π –Ω–∞—Å—Ç—Ä–æ–π —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–æ–≤. –û–±—Å—É–∂–¥–∞—é—Ç—Å—è –≤–æ–ø—Ä–æ—Å—ã –ø—Ä–µ–∫—Ä–∞—â–µ–Ω–∏—è –æ–≥–Ω—è, –æ–±–º–µ–Ω–∞ –ø–ª–µ–Ω–Ω—ã–º–∏ –∏ —Å–æ–∑–¥–∞–Ω–∏—è –≥—É–º–∞–Ω–∏—Ç–∞—Ä–Ω—ã—Ö –∫–æ—Ä–∏–¥–æ—Ä–æ–≤. –≠–∫—Å–ø–µ—Ä—Ç—ã –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Å–æ–≥–ª–∞—à–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —Å—Ç–∞—Ç—å –æ—Å–Ω–æ–≤–æ–π –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –º–∏—Ä–Ω–æ–≥–æ —É—Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞.',
            source: 'France24',
            tension: 32.1
        },
        {
            date: new Date(Date.now() - 1000 * 60 * 600),
            title: '–ú–∞—Å—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞—Ç–∞–∫–∞ –±–µ—Å–ø–∏–ª–æ—Ç–Ω–∏–∫–æ–≤ –æ—Ç—Ä–∞–∂–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞–º–∏ –ü–í–û',
            content: '–°–∏–ª—ã –ü–í–û —É—Å–ø–µ—à–Ω–æ –æ—Ç—Ä–∞–∑–∏–ª–∏ –∫—Ä—É–ø–Ω–æ–º–∞—Å—à—Ç–∞–±–Ω—É—é –∞—Ç–∞–∫—É –±–µ—Å–ø–∏–ª–æ—Ç–Ω–∏–∫–æ–≤ –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É. –ü–æ –¥–∞–Ω–Ω—ã–º –∫–æ–º–∞–Ω–¥–æ–≤–∞–Ω–∏—è, –±—ã–ª–æ —Å–±–∏—Ç–æ –±–æ–ª–µ–µ 40 –ë–ü–õ–ê —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤. –ê—Ç–∞–∫–∞ –±—ã–ª–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã –∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ —É–∑–ª—ã. –ë–ª–∞–≥–æ–¥–∞—Ä—è —Å–ª–∞–∂–µ–Ω–Ω—ã–º –¥–µ–π—Å—Ç–≤–∏—è–º —Ä–∞—Å—á–µ—Ç–æ–≤ –ü–í–û –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤ —Ä–∞–¥–∏–æ—ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –±–æ—Ä—å–±—ã, —É–¥–∞–ª–æ—Å—å –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å —Å–µ—Ä—å–µ–∑–Ω—ã–µ —Ä–∞–∑—Ä—É—à–µ–Ω–∏—è. –ü–æ—Å—Ç—Ä–∞–¥–∞–≤—à–∏—Ö —Å—Ä–µ–¥–∏ –≥—Ä–∞–∂–¥–∞–Ω—Å–∫–æ–≥–æ –Ω–∞—Å–µ–ª–µ–Ω–∏—è –Ω–µ—Ç. –†–∞–±–æ—Ç–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –Ω–µ –Ω–∞—Ä—É—à–µ–Ω–∞.',
            source: 'DW',
            tension: 88.9
        },
        {
            date: new Date(Date.now() - 1000 * 60 * 720),
            title: '–í–æ–µ–Ω–Ω—ã–µ —É—á–µ–Ω–∏—è –ù–ê–¢–û –≤–±–ª–∏–∑–∏ –≤–æ—Å—Ç–æ—á–Ω—ã—Ö –≥—Ä–∞–Ω–∏—Ü',
            content: '–ê–ª—å—è–Ω—Å –ø—Ä–æ–≤–æ–¥–∏—Ç –º–∞—Å—à—Ç–∞–±–Ω—ã–µ –≤–æ–µ–Ω–Ω—ã–µ —É—á–µ–Ω–∏—è —Å —É—á–∞—Å—Ç–∏–µ–º –±–æ–ª–µ–µ 50 —Ç—ã—Å—è—á –≤–æ–µ–Ω–Ω–æ—Å–ª—É–∂–∞—â–∏—Ö –∏–∑ 20 —Å—Ç—Ä–∞–Ω. –ú–∞–Ω–µ–≤—Ä—ã –≤–∫–ª—é—á–∞—é—Ç –æ—Ç—Ä–∞–±–æ—Ç–∫—É –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å—É—Ö–æ–ø—É—Ç–Ω—ã—Ö –≤–æ–π—Å–∫, –∞–≤–∏–∞—Ü–∏–∏ –∏ —Ñ–ª–æ—Ç–∞. –£—á–µ–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ –ø–æ–≤—ã—à–µ–Ω–∏–µ –±–æ–µ–≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∞–ª—å—è–Ω—Å–∞ –∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é –µ–¥–∏–Ω—Å—Ç–≤–∞ –≤ –≤–æ–ø—Ä–æ—Å–∞—Ö –∫–æ–ª–ª–µ–∫—Ç–∏–≤–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –û—Ç—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Å—Ü–µ–Ω–∞—Ä–∏–∏ –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –≤–æ–∑–º–æ–∂–Ω—ã–µ —É–≥—Ä–æ–∑—ã. –ì–µ–Ω–µ—Ä–∞–ª—å–Ω—ã–π —Å–µ–∫—Ä–µ—Ç–∞—Ä—å –ù–ê–¢–û –ø–æ–¥—á–µ—Ä–∫–Ω—É–ª –æ–±–æ—Ä–æ–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä —É—á–µ–Ω–∏–π –∏ –∏—Ö —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–º—É –ø—Ä–∞–≤—É.',
            source: 'Euronews',
            tension: 67.5
        },
        {
            date: new Date(Date.now() - 1000 * 60 * 900),
            title: '–≠–≤–∞–∫—É–∞—Ü–∏—è –º–∏—Ä–Ω–æ–≥–æ –Ω–∞—Å–µ–ª–µ–Ω–∏—è –∏–∑ –∑–æ–Ω—ã –±–æ–µ–≤—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è',
            content: '–ì—É–º–∞–Ω–∏—Ç–∞—Ä–Ω—ã–µ –∫–æ—Ä–∏–¥–æ—Ä—ã —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É—é—Ç –≤ —à—Ç–∞—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ. –ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å—É—Ç–∫–∏ —ç–≤–∞–∫—É–∏—Ä–æ–≤–∞–Ω–æ –±–æ–ª–µ–µ 2000 —á–µ–ª–æ–≤–µ–∫, –≤–∫–ª—é—á–∞—è –¥–µ—Ç–µ–π, –ø–æ–∂–∏–ª—ã—Ö –ª—é–¥–µ–π –∏ –ª—é–¥–µ–π —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏. –≠–≤–∞–∫—É–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –∂–∏–ª—å–µ, –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –ø–æ–º–æ—â—å –∏ —Å–æ—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞. –í–æ–ª–æ–Ω—Ç–µ—Ä—ã –∏ –≥—É–º–∞–Ω–∏—Ç–∞—Ä–Ω—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –Ω—É–∂–¥ –±–µ–∂–µ–Ω—Ü–µ–≤. –í–ª–∞—Å—Ç–∏ –ø—Ä–∏–∑—ã–≤–∞—é—Ç –∂–∏—Ç–µ–ª–µ–π –ø—Ä–∏—Ñ—Ä–æ–Ω—Ç–æ–≤—ã—Ö —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–π –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —ç–≤–∞–∫—É–∞—Ü–∏–∏.',
            source: '–ì–∞–∑–µ—Ç–∞.—Ä—É',
            tension: 71.2
        },
        {
            date: new Date(Date.now() - 1000 * 60 * 1080),
            title: '–†–∞–∑–≤–µ–¥–∫–∞ —Å–æ–æ–±—â–∞–µ—Ç –æ –ø–µ—Ä–µ–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–µ –≤—Ä–∞–∂–µ—Å–∫–∏—Ö —Å–∏–ª',
            content: '–ü–æ –¥–∞–Ω–Ω—ã–º —Ä–∞–∑–≤–µ–¥–∫–∏, –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫ –ø—Ä–æ–≤–æ–¥–∏—Ç –ø–µ—Ä–µ–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É –≤–æ–π—Å–∫ –Ω–∞ —é–∂–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏. –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö –≤–æ–∏–Ω—Å–∫–∏—Ö –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π –∏ —Ç–µ—Ö–Ω–∏–∫–∏. –ê–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞—é—Ç, —á—Ç–æ —ç—Ç–æ –º–æ–∂–µ—Ç —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ–≤–∞—Ç—å –æ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –∫ –Ω–æ–≤–æ–π –Ω–∞—Å—Ç—É–ø–∞—Ç–µ–ª—å–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–ª–∏, –Ω–∞–æ–±–æ—Ä–æ—Ç, –æ–± —É—Å–∏–ª–µ–Ω–∏–∏ –æ–±–æ—Ä–æ–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π. –£–∫—Ä–∞–∏–Ω—Å–∫–æ–µ –∫–æ–º–∞–Ω–¥–æ–≤–∞–Ω–∏–µ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å–∏—Ç—É–∞—Ü–∏—é –∏ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–µ—Ä—ã –¥–ª—è –ø—Ä–æ—Ç–∏–≤–æ–¥–µ–π—Å—Ç–≤–∏—è –≤–æ–∑–º–æ–∂–Ω—ã–º —É–≥—Ä–æ–∑–∞–º. –†–µ–∑–µ—Ä–≤—ã –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –≤ –ø–æ–≤—ã—à–µ–Ω–Ω—É—é –±–æ–µ–≤—É—é –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å.',
            source: '–ö–æ–º–º–µ—Ä—Å–∞–Ω—Ç—ä',
            tension: 79.6
        }
    ];
    
    tbody.innerHTML = '';
    testNews.forEach(news => {
                    const row = document.createElement('tr');
        row.classList.add('fade-in-up');
                    
                    row.innerHTML = `
                        <td>
                <small style="color: #2c3e50; font-weight: 500;">${formatDate(news.date)}</small>
                        </td>
                        <td>
                            <div class="fw-bold">
                    <span class="text-decoration-none" style="color: #4fc3f7; font-size: 1.05rem; cursor: pointer;">${news.title}</span>
                            </div>
                <small style="color: #e0e0e0; line-height: 1.5;">${news.content}</small>
                        </td>
                        <td>
                <span class="category-badge" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); font-size: 0.9rem;">
                    üéØ –í–æ–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
                </span>
                        </td>
                        <td>
                <span class="tension-badge" style="background-color: ${getTensionColorForValue(news.tension)}; font-size: 0.95rem; padding: 0.5rem 1rem;">
                    ${news.tension.toFixed(1)}%
                </span>
                        </td>
                        <td>
                <small style="color: #2c3e50; font-weight: 600;">${news.source}</small>
                        </td>
                    `;
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ —Å—Ç—Ä–æ–∫—É
        row.addEventListener('click', function() {
            openNewsModal({
                title: news.title,
                date: formatDate(news.date),
                source: news.source,
                category: 'military_operations',
                categoryName: '–í–æ–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏',
                tension: news.tension.toFixed(1),
                tensionColor: getTensionColorForValue(news.tension),
                content: news.content,
                url: '#'
            });
        });
        
                    tbody.appendChild(row);
                });
}

function getTensionColorForValue(tension) {
    if (tension >= 80) return '#8e44ad'; // –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è - —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π
    if (tension >= 60) return '#e74c3c'; // –í—ã—Å–æ–∫–∞—è - –∫—Ä–∞—Å–Ω—ã–π
    if (tension >= 40) return '#f39c12'; // –°—Ä–µ–¥–Ω—è—è - –æ—Ä–∞–Ω–∂–µ–≤—ã–π
    return '#2ecc71'; // –ù–∏–∑–∫–∞—è - –∑–µ–ª–µ–Ω—ã–π
}

function getTensionColorClass(score) {
    if (score >= 8) return 'critical';
    if (score >= 6) return 'high';
    if (score >= 4) return 'medium';
    return 'low';
}

function getTensionColor(score) {
    if (score < 0.3) return '#28a745'; // –ó–µ–ª–µ–Ω—ã–π
    if (score < 0.6) return '#ffc107'; // –ñ–µ–ª—Ç—ã–π
    return '#dc3545'; // –ö—Ä–∞—Å–Ω—ã–π
}

function getCategoryName(category) {
    const categories = {
        // –û—Å–Ω–æ–≤–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        'military_operations': '–í–æ–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏',
        'humanitarian_crisis': '–ì—É–º–∞–Ω–∏—Ç–∞—Ä–Ω—ã–π –∫—Ä–∏–∑–∏—Å',
        'economic_consequences': '–≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è',
        'political_decisions': '–ü–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è',
        'information_social': '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ-—Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã'
    };
    return categories[category] || category;
}

function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('ru-RU', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    });
}

// –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç–∏
function loadRealTensionChart(category, dateRange) {
    const chartContainer = document.getElementById('tensionChart');
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ –¥–ª—è –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    chartContainer.innerHTML = `
        <div class="loading-spinner">
            <div class="spinner-custom"></div>
            <p class="mt-2 text-muted">–†–∞—Å—á–µ—Ç —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç–∏...</p>
        </div>
    `;
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è Canvas-–≥—Ä–∞—Ñ–∏–∫–∞
    const tensionUrl = `/api/ukraine_analytics/tension_data?category=${category}&days=${dateRange}&forecast_days=5`;
    console.log('Loading tension data from:', tensionUrl);
    
    fetch(tensionUrl)
        .then(response => response.json())
        .then(data => {
            console.log('Tension data response:', data);
            if (data.status === 'success' && data.historical_data && data.historical_data.length > 0) {
                createRealTensionChart(data, chartContainer);
            } else {
                chartContainer.innerHTML = `
                    <div class="alert alert-info">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞</div>
                `;
            }
        })
        .catch(error => {
            console.error('Error loading tension data:', error);
            chartContainer.innerHTML = `
                <div class="alert alert-danger">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</div>
            `;
        });
}

function createRealTensionChart(data, container) {
    // –°–æ–∑–¥–∞–µ–º Canvas –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞–ª—å–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞
    container.innerHTML = `
        <div class="chart-placeholder">
            <canvas id="realTensionCanvas" width="1200" height="500"></canvas>
            <div class="mt-3" style="color: #2c3e50;">
                <div class="row text-center">
                    <div class="col-md-3">
                        <strong style="color: #4a90e2;">üìä –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö —Ç–æ—á–µ–∫:</strong><br>${data.historical_points || (data.historical_data ? data.historical_data.length : 0)} / ${data.target_points || 7}
                    </div>
                    <div class="col-md-3">
                        <strong style="color: #7b68ee;">üîÆ –ü—Ä–æ–≥–Ω–æ–∑–Ω—ã—Ö —Ç–æ—á–µ–∫:</strong><br>${data.forecast_data ? data.forecast_data.length : 0}
                    </div>
                    <div class="col-md-3">
                        <strong style="color: #6c757d;">üìà –°—Ä–µ–¥–Ω—è—è –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç—å:</strong><br>${data.avg_tension || '0'}%
                    </div>
                    <div class="col-md-3">
                        <strong style="color: #5a6c7d;">üìâ –¢—Ä–µ–Ω–¥:</strong><br>${data.trend || '–°—Ç–∞–±–∏–ª—å–Ω—ã–π'} (${data.trend_percent > 0 ? '+' : ''}${data.trend_percent || '0'}%)
                    </div>
                </div>
            </div>
                </div>
            `;
    
    // –†–∏—Å—É–µ–º –≥—Ä–∞—Ñ–∏–∫ –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç–∏
    const canvas = document.getElementById('realTensionCanvas');
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    const width = canvas.width;
    const height = canvas.height;
    const padding = 80;
    const chartWidth = width - 2 * padding;
    const chartHeight = height - 2 * padding;
    
    // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    const historicalData = data.historical_data.map(d => ({
        date: new Date(d.date),
        value: d.value
    }));
    const forecastData = data.forecast_data.map(d => ({
        date: new Date(d.date),
        value: d.value
    }));
    
    const allData = [...historicalData, ...forecastData];
    if (allData.length === 0) return;
    
    const minDate = Math.min(...allData.map(d => d.date.getTime()));
    const maxDate = Math.max(...allData.map(d => d.date.getTime()));
    const totalPoints = allData.length;
    const historicalPoints = historicalData.length;
    const forecastPoints = forecastData.length;
    
    // –ó–∞–ª–∏–≤–∫–∞ —Ñ–æ–Ω–∞ —Å–≤–µ—Ç–ª—ã–º —Ü–≤–µ—Ç–æ–º
    ctx.fillStyle = '#ffffff';
    ctx.fillRect(0, 0, width, height);
    
    // –ó–∞–≥–æ–ª–æ–≤–æ–∫
    ctx.fillStyle = '#2c3e50';
    ctx.font = 'bold 20px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('–ò–Ω—Ç–µ–≥—Ä–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç–∏', width / 2, 35);
    
    // –†–∏—Å—É–µ–º —Å–µ—Ç–∫—É
    ctx.strokeStyle = 'rgba(0, 0, 0, 0.1)';
    ctx.lineWidth = 1;
    for (let i = 0; i <= 5; i++) {
        const y = padding + (chartHeight / 5) * i;
        ctx.beginPath();
        ctx.moveTo(padding, y);
        ctx.lineTo(width - padding, y);
        ctx.stroke();
        
        // –ü–æ–¥–ø–∏—Å–∏ –ø–æ Y (—Ç—ë–º–Ω—ã–º —Ü–≤–µ—Ç–æ–º)
        ctx.fillStyle = '#2c3e50';
        ctx.font = 'bold 13px Arial';
        ctx.textAlign = 'right';
        ctx.fillText((100 - i * 20) + '%', padding - 15, y + 5);
    }
    
    // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏ —Å–µ—Ç–∫–∏
    const gridSteps = Math.min(totalPoints, 10);
    for (let i = 0; i <= gridSteps; i++) {
        const x = padding + (chartWidth / gridSteps) * i;
        ctx.beginPath();
        ctx.moveTo(x, padding);
        ctx.lineTo(x, height - padding);
        ctx.stroke();
    }
    
    // –†–∏—Å—É–µ–º –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
    ctx.strokeStyle = '#667eea';
    ctx.lineWidth = 3;
    ctx.beginPath();
    historicalData.forEach((point, i) => {
        const x = padding + (chartWidth / totalPoints) * i;
        const y = padding + chartHeight - (point.value / 100) * chartHeight;
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
    });
    ctx.stroke();
    
    // –†–∏—Å—É–µ–º —Ç–æ—á–∫–∏ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    ctx.fillStyle = '#667eea';
    historicalData.forEach((point, i) => {
        const x = padding + (chartWidth / totalPoints) * i;
        const y = padding + chartHeight - (point.value / 100) * chartHeight;
        ctx.beginPath();
        ctx.arc(x, y, 4, 0, 2 * Math.PI);
        ctx.fill();
    });
    
    // –†–∏—Å—É–µ–º –ø—Ä–æ–≥–Ω–æ–∑–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø—É–Ω–∫—Ç–∏—Ä–æ–º)
    if (forecastData.length > 0) {
        ctx.strokeStyle = '#764ba2';
        ctx.lineWidth = 3;
        ctx.setLineDash([5, 5]);
        ctx.beginPath();
        const lastHistX = padding + (chartWidth / totalPoints) * (historicalData.length - 1);
        const lastHistY = padding + chartHeight - (historicalData[historicalData.length - 1].value / 100) * chartHeight;
        ctx.moveTo(lastHistX, lastHistY);
        forecastData.forEach((point, i) => {
            const x = padding + (chartWidth / totalPoints) * (historicalData.length + i);
            const y = padding + chartHeight - (point.value / 100) * chartHeight;
            ctx.lineTo(x, y);
        });
        ctx.stroke();
        ctx.setLineDash([]);
        
        // –†–∏—Å—É–µ–º —Ç–æ—á–∫–∏ –Ω–∞ –ø—Ä–æ–≥–Ω–æ–∑–µ
        ctx.fillStyle = '#764ba2';
        forecastData.forEach((point, i) => {
            const x = padding + (chartWidth / totalPoints) * (historicalData.length + i);
            const y = padding + chartHeight - (point.value / 100) * chartHeight;
            ctx.beginPath();
            ctx.arc(x, y, 4, 0, 2 * Math.PI);
            ctx.fill();
        });
    }
    
    // –ó–æ–Ω—ã –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç–∏ (–ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ)
    ctx.fillStyle = 'rgba(231, 76, 60, 0.15)';
    ctx.fillRect(padding, padding, chartWidth, chartHeight * 0.2);
    ctx.fillStyle = '#2c3e50';
    ctx.font = 'bold 12px Arial';
    ctx.textAlign = 'left';
    ctx.fillText('üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –∑–æ–Ω–∞ (80-100%)', padding + 10, padding + 20);
    
    ctx.fillStyle = 'rgba(243, 156, 18, 0.15)';
    ctx.fillRect(padding, padding + chartHeight * 0.2, chartWidth, chartHeight * 0.2);
    ctx.fillStyle = '#2c3e50';
    ctx.fillText('üü† –í—ã—Å–æ–∫–∞—è –∑–æ–Ω–∞ (60-80%)', padding + 10, padding + chartHeight * 0.2 + 20);
    
    ctx.fillStyle = 'rgba(241, 196, 15, 0.1)';
    ctx.fillRect(padding, padding + chartHeight * 0.4, chartWidth, chartHeight * 0.2);
    ctx.fillStyle = '#2c3e50';
    ctx.fillText('üü° –°—Ä–µ–¥–Ω—è—è –∑–æ–Ω–∞ (40-60%)', padding + 10, padding + chartHeight * 0.4 + 20);
    
    ctx.fillStyle = 'rgba(46, 204, 113, 0.1)';
    ctx.fillRect(padding, padding + chartHeight * 0.6, chartWidth, chartHeight * 0.4);
    ctx.fillStyle = '#2c3e50';
    ctx.fillText('üü¢ –ù–∏–∑–∫–∞—è –∑–æ–Ω–∞ (0-40%)', padding + 10, padding + chartHeight * 0.6 + 20);
    
    // –õ–µ–≥–µ–Ω–¥–∞ –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
    const legendX = width - 220;
    const legendY = 60;
    
    // –§–æ–Ω –¥–ª—è –ª–µ–≥–µ–Ω–¥—ã
    ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
    ctx.fillRect(legendX - 10, legendY - 10, 210, 70);
    ctx.strokeStyle = '#ffffff';
    ctx.lineWidth = 2;
    ctx.strokeRect(legendX - 10, legendY - 10, 210, 70);
    
    // –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
    ctx.strokeStyle = '#667eea';
    ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.moveTo(legendX, legendY + 5);
    ctx.lineTo(legendX + 30, legendY + 5);
    ctx.stroke();
    
    ctx.fillStyle = '#667eea';
    ctx.beginPath();
    ctx.arc(legendX + 15, legendY + 5, 5, 0, 2 * Math.PI);
    ctx.fill();
    
    ctx.fillStyle = '#2c3e50';
    ctx.font = 'bold 12px Arial';
    ctx.textAlign = 'left';
    ctx.fillText('–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ', legendX + 40, legendY + 10);
    
    // –ü—Ä–æ–≥–Ω–æ–∑
    if (forecastData.length > 0) {
        ctx.strokeStyle = '#9b59b6';
        ctx.lineWidth = 4;
        ctx.setLineDash([8, 4]);
        ctx.beginPath();
        ctx.moveTo(legendX, legendY + 35);
        ctx.lineTo(legendX + 30, legendY + 35);
        ctx.stroke();
        ctx.setLineDash([]);
        
        ctx.fillStyle = '#9b59b6';
        ctx.beginPath();
        ctx.arc(legendX + 15, legendY + 35, 5, 0, 2 * Math.PI);
        ctx.fill();
        
        ctx.fillStyle = '#2c3e50';
        ctx.fillText('–ü—Ä–æ–≥–Ω–æ–∑ (5 –¥–Ω–µ–π)', legendX + 40, legendY + 40);
    }
}

function loadTestTensionChart(container, dateRange) {
    container.innerHTML = `
        <div class="chart-placeholder">
            <canvas id="testTensionCanvas" width="1200" height="500"></canvas>
            <div class="mt-3" style="color: #2c3e50;">
                <div class="row text-center">
                    <div class="col-md-3">
                        <strong style="color: #4a90e2;">üìä –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö —Ç–æ—á–µ–∫:</strong><br>${actualPoints}
                    </div>
                    <div class="col-md-3">
                        <strong style="color: #9b59b6;">üîÆ –ü—Ä–æ–≥–Ω–æ–∑–Ω—ã—Ö —Ç–æ—á–µ–∫:</strong><br>5
                    </div>
                    <div class="col-md-3">
                        <strong style="color: #f39c12;">üìà –°—Ä–µ–¥–Ω—è—è –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç—å:</strong><br>67.3%
                    </div>
                    <div class="col-md-3">
                        <strong style="color: #e74c3c;">üìâ –¢—Ä–µ–Ω–¥:</strong><br>–í–æ–∑—Ä–∞—Å—Ç–∞—é—â–∏–π (+12.4%)
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // –†–∏—Å—É–µ–º –≥—Ä–∞—Ñ–∏–∫ –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç–∏
    const canvas = document.getElementById('testTensionCanvas');
    if (canvas) {
        const ctx = canvas.getContext('2d');
        const width = canvas.width;
        const height = canvas.height;
        const padding = 80;
        const chartWidth = width - 2 * padding;
        const chartHeight = height - 2 * padding;
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–µ—Ä–∏–æ–¥–∞
        const historicalDays = parseInt(dateRange);
        const forecastDays = 5;
        const totalDays = historicalDays + forecastDays;
        
        const historicalData = [];
        let baseValue = 45;
        
        // –î–ª—è 7 –¥–Ω–µ–π - 7 —Ç–æ—á–µ–∫, –¥–ª—è 30 –¥–Ω–µ–π - 15 —Ç–æ—á–µ–∫ (–∫–∞–∂–¥—ã–µ 2 –¥–Ω—è), –¥–ª—è 90 –¥–Ω–µ–π - 30 —Ç–æ—á–µ–∫ (–∫–∞–∂–¥—ã–µ 3 –¥–Ω—è)
        let step = 1;
        if (historicalDays === 30) step = 2;
        else if (historicalDays === 90) step = 3;
        
        const actualPoints = Math.ceil(historicalDays / step);
        
        for (let i = 0; i < actualPoints; i++) {
            baseValue += (Math.random() - 0.4) * 8;
            baseValue = Math.max(30, Math.min(85, baseValue));
            historicalData.push(baseValue);
        }
        
        const forecastData = [];
        let lastValue = historicalData[historicalData.length - 1];
        for (let i = 0; i < forecastDays; i++) {
            lastValue += (Math.random() - 0.3) * 6;
            lastValue = Math.max(40, Math.min(90, lastValue));
            forecastData.push(lastValue);
        }
        
        // –ó–∞–ª–∏–≤–∫–∞ —Ñ–æ–Ω–∞ —Ç–µ–º–Ω—ã–º —Ü–≤–µ—Ç–æ–º
        ctx.fillStyle = '#1e3a6a';
        ctx.fillRect(0, 0, width, height);
        
        // –ó–∞–≥–æ–ª–æ–≤–æ–∫
        ctx.fillStyle = '#2c3e50';
        ctx.font = 'bold 20px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('–ò–Ω—Ç–µ–≥—Ä–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç–∏ - –í–æ–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏', width / 2, 35);
        
        // –†–∏—Å—É–µ–º —Å–µ—Ç–∫—É
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
        ctx.lineWidth = 1;
        for (let i = 0; i <= 5; i++) {
            const y = padding + (chartHeight / 5) * i;
            ctx.beginPath();
            ctx.moveTo(padding, y);
            ctx.lineTo(width - padding, y);
            ctx.stroke();
            
            // –ü–æ–¥–ø–∏—Å–∏ –ø–æ Y (–±–µ–ª—ã–º —Ü–≤–µ—Ç–æ–º)
            ctx.fillStyle = '#2c3e50';
            ctx.font = 'bold 13px Arial';
            ctx.textAlign = 'right';
            ctx.fillText((100 - i * 20) + '%', padding - 15, y + 5);
        }
        
        // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏ —Å–µ—Ç–∫–∏
        const gridSteps = Math.min(totalDays, 10);
        for (let i = 0; i <= gridSteps; i++) {
            const x = padding + (chartWidth / gridSteps) * i;
            ctx.beginPath();
            ctx.moveTo(x, padding);
            ctx.lineTo(x, height - padding);
            ctx.stroke();
        }
        
        // –†–∏—Å—É–µ–º –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
        ctx.strokeStyle = '#667eea';
        ctx.lineWidth = 3;
        ctx.beginPath();
        historicalData.forEach((value, i) => {
            const x = padding + (chartWidth / (actualPoints + forecastDays)) * i;
            const y = padding + chartHeight - (value / 100) * chartHeight;
            if (i === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
        });
        ctx.stroke();
        
        // –†–∏—Å—É–µ–º —Ç–æ—á–∫–∏ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
        ctx.fillStyle = '#667eea';
        historicalData.forEach((value, i) => {
            const x = padding + (chartWidth / (actualPoints + forecastDays)) * i;
            const y = padding + chartHeight - (value / 100) * chartHeight;
            ctx.beginPath();
            ctx.arc(x, y, 4, 0, 2 * Math.PI);
            ctx.fill();
        });
        
        // –†–∏—Å—É–µ–º –ø—Ä–æ–≥–Ω–æ–∑–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø—É–Ω–∫—Ç–∏—Ä–æ–º)
        ctx.strokeStyle = '#764ba2';
        ctx.lineWidth = 3;
        ctx.setLineDash([5, 5]);
        ctx.beginPath();
        const lastHistX = padding + (chartWidth / (actualPoints + forecastDays)) * (actualPoints - 1);
        const lastHistY = padding + chartHeight - (historicalData[historicalData.length - 1] / 100) * chartHeight;
        ctx.moveTo(lastHistX, lastHistY);
        forecastData.forEach((value, i) => {
            const x = padding + (chartWidth / (actualPoints + forecastDays)) * (actualPoints + i);
            const y = padding + chartHeight - (value / 100) * chartHeight;
            ctx.lineTo(x, y);
        });
        ctx.stroke();
        ctx.setLineDash([]);
        
        // –†–∏—Å—É–µ–º —Ç–æ—á–∫–∏ –Ω–∞ –ø—Ä–æ–≥–Ω–æ–∑–µ
        ctx.fillStyle = '#764ba2';
        forecastData.forEach((value, i) => {
            const x = padding + (chartWidth / (actualPoints + forecastDays)) * (actualPoints + i);
            const y = padding + chartHeight - (value / 100) * chartHeight;
            ctx.beginPath();
            ctx.arc(x, y, 4, 0, 2 * Math.PI);
            ctx.fill();
        });
        
        // –ó–æ–Ω—ã –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç–∏ (–ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ)
        ctx.fillStyle = 'rgba(231, 76, 60, 0.15)';
        ctx.fillRect(padding, padding, chartWidth, chartHeight * 0.2);
        ctx.fillStyle = '#2c3e50';
        ctx.font = 'bold 12px Arial';
        ctx.textAlign = 'left';
        ctx.fillText('üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –∑–æ–Ω–∞ (80-100%)', padding + 10, padding + 20);
        
        ctx.fillStyle = 'rgba(243, 156, 18, 0.15)';
        ctx.fillRect(padding, padding + chartHeight * 0.2, chartWidth, chartHeight * 0.2);
        ctx.fillStyle = '#2c3e50';
        ctx.fillText('üü† –í—ã—Å–æ–∫–∞—è –∑–æ–Ω–∞ (60-80%)', padding + 10, padding + chartHeight * 0.2 + 20);
        
        ctx.fillStyle = 'rgba(241, 196, 15, 0.1)';
        ctx.fillRect(padding, padding + chartHeight * 0.4, chartWidth, chartHeight * 0.2);
        ctx.fillStyle = '#2c3e50';
        ctx.fillText('üü° –°—Ä–µ–¥–Ω—è—è –∑–æ–Ω–∞ (40-60%)', padding + 10, padding + chartHeight * 0.4 + 20);
        
        ctx.fillStyle = 'rgba(46, 204, 113, 0.1)';
        ctx.fillRect(padding, padding + chartHeight * 0.6, chartWidth, chartHeight * 0.4);
        ctx.fillStyle = '#2c3e50';
        ctx.fillText('üü¢ –ù–∏–∑–∫–∞—è –∑–æ–Ω–∞ (0-40%)', padding + 10, padding + chartHeight * 0.6 + 20);
        
        // –õ–µ–≥–µ–Ω–¥–∞ –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
        const legendX = width - 220;
        const legendY = 60;
        
        // –§–æ–Ω –¥–ª—è –ª–µ–≥–µ–Ω–¥—ã
        ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
        ctx.fillRect(legendX - 10, legendY - 10, 210, 70);
        ctx.strokeStyle = '#ffffff';
        ctx.lineWidth = 2;
        ctx.strokeRect(legendX - 10, legendY - 10, 210, 70);
        
        // –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
        ctx.strokeStyle = '#667eea';
        ctx.lineWidth = 4;
        ctx.beginPath();
        ctx.moveTo(legendX, legendY + 5);
        ctx.lineTo(legendX + 30, legendY + 5);
        ctx.stroke();
        
        ctx.fillStyle = '#667eea';
        ctx.beginPath();
        ctx.arc(legendX + 15, legendY + 5, 5, 0, 2 * Math.PI);
        ctx.fill();
        
        ctx.fillStyle = '#2c3e50';
        ctx.font = 'bold 12px Arial';
        ctx.textAlign = 'left';
        ctx.fillText('–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ', legendX + 40, legendY + 10);
        
        // –ü—Ä–æ–≥–Ω–æ–∑
        ctx.strokeStyle = '#9b59b6';
        ctx.lineWidth = 4;
        ctx.setLineDash([8, 4]);
        ctx.beginPath();
        ctx.moveTo(legendX, legendY + 35);
        ctx.lineTo(legendX + 30, legendY + 35);
        ctx.stroke();
        ctx.setLineDash([]);
        
        ctx.fillStyle = '#9b59b6';
        ctx.beginPath();
        ctx.arc(legendX + 15, legendY + 35, 5, 0, 2 * Math.PI);
        ctx.fill();
        
        ctx.fillStyle = '#2c3e50';
        ctx.fillText('–ü—Ä–æ–≥–Ω–æ–∑ (5 –¥–Ω–µ–π)', legendX + 40, legendY + 40);
    }
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
function openNewsModal(newsData) {
    const modal = document.getElementById('newsModal');
    
    // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
    document.getElementById('modalTitle').textContent = newsData.title;
    document.getElementById('modalDate').textContent = newsData.date;
    document.getElementById('modalSource').textContent = newsData.source;
    document.getElementById('modalCategory').textContent = newsData.categoryName;
    document.getElementById('modalTension').textContent = newsData.tension === '–ù/–î' ? '–ù/–î' : newsData.tension + '%';
    
    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å—Ç–∞—Ç—å–∏
    let contentText = newsData.content || '';
    
    // –ï—Å–ª–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    if (!contentText || contentText.length < 200) {
        contentText = `–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. 
        
–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
‚Ä¢ –°—Ç–∞—Ç—å—è –±—ã–ª–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–æ–ª—å–∫–æ —Å –∫—Ä–∞—Ç–∫–∏–º –æ–ø–∏—Å–∞–Ω–∏–µ–º
‚Ä¢ –ü–æ–ª–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –Ω–µ –±—ã–ª–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ
‚Ä¢ –°—Ç–∞—Ç—å—è —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫—Ä–∞—Ç–∫—É—é –∞–Ω–Ω–æ—Ç–∞—Ü–∏—é

–î–ª—è —á—Ç–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫ —Å—Ç–∞—Ç—å–∏.`;
    }
    
    document.getElementById('modalContent').textContent = contentText;
    document.getElementById('modalLink').href = newsData.url || '#';
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    modal.classList.add('show');
    document.body.style.overflow = 'hidden'; // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Ñ–æ–Ω–∞
}

function closeNewsModal() {
    const modal = document.getElementById('newsModal');
    modal.classList.remove('show');
    document.body.style.overflow = ''; // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
window.onclick = function(event) {
    const modal = document.getElementById('newsModal');
    if (event.target === modal) {
        closeNewsModal();
    }
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –Ω–∞–∂–∞—Ç–∏—é Escape
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        closeNewsModal();
    }
});

// –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    updateAnalytics();
});
</script>
{% endblock %}