{% extends "base.html" %}

{% block title %}–î–∞—à–±–æ—Ä–¥ –°–í–û –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ - NewsAnalytics Pro{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/svo_dashboard.css') }}">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–∞—à–±–æ—Ä–¥–∞ -->
    <div class="dashboard-header">
        <h1>üìä –î–∞—à–±–æ—Ä–¥ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –°–í–û</h1>
        <p class="subtitle">–ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–æ–≤ –∏–Ω—Ç–µ—Ä–µ—Å–∞ –∏ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç–∏</p>
        <div class="period-info">
            üìÖ –ü–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞: {{ analysis_period }}
        </div>
        <div style="margin-top: 15px;">
            <button class="refresh-btn" onclick="refreshDashboard()">
                üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
            </button>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-value" style="color: #3498db;">{{ (analysis_result.avg_interest_level or 0)|round(1) }}%</div>
            <div class="stat-label">–°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å –∏–Ω—Ç–µ—Ä–µ—Å–∞</div>
            <div class="trend-indicator trend-{{ analysis_result.trend_direction or 'stable' }}">
                {% if analysis_result.trend_direction == 'falling' %}
                    üìâ –ü–∞–¥–∞—é—â–∏–π —Ç—Ä–µ–Ω–¥
                {% elif analysis_result.trend_direction == 'rising' %}
                    üìà –†–∞—Å—Ç—É—â–∏–π —Ç—Ä–µ–Ω–¥
                {% else %}
                    ‚û°Ô∏è –°—Ç–∞–±–∏–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–¥
                {% endif %}
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-value" style="color: #e74c3c;">{{ (analysis_result.avg_social_tension or 0)|round(1) }}%</div>
            <div class="stat-label">–°–æ—Ü–∏–∞–ª—å–Ω–∞—è –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç—å</div>
            <div class="trend-indicator trend-rising">
                üìà –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π —Ä–æ—Å—Ç
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-value" style="color: #27ae60;">{{ (analysis_result.total_mentions or 0)|int }}</div>
            <div class="stat-label">–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-value" style="color: #f39c12;">{{ total_data_points }}</div>
            <div class="stat-label">–¢–æ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö</div>
        </div>
    </div>

    <!-- –ì—Ä–∞—Ñ–∏–∫–∏ -->
    <div class="charts-section">
        <!-- –ì—Ä–∞—Ñ–∏–∫ –¥–∏–Ω–∞–º–∏–∫–∏ –∏–Ω—Ç–µ—Ä–µ—Å–∞ -->
        {% if charts.interest_dynamics %}
        <div class="chart-container">
            <h3 class="chart-title">üìâ –î–∏–Ω–∞–º–∏–∫–∞ –∏–Ω—Ç–µ—Ä–µ—Å–∞ –∫ —Ç–µ–º–∞–º –°–í–û (2022-2025)</h3>
            <img src="data:image/png;base64,{{ charts.interest_dynamics }}" alt="–ì—Ä–∞—Ñ–∏–∫ –¥–∏–Ω–∞–º–∏–∫–∏ –∏–Ω—Ç–µ—Ä–µ—Å–∞" class="chart-image">
        </div>
        {% endif %}

        <!-- –ì—Ä–∞—Ñ–∏–∫ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç–∏ -->
        {% if charts.social_tension %}
        <div class="chart-container">
            <h3 class="chart-title">üìà –†–æ—Å—Ç —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç–∏</h3>
            <img src="data:image/png;base64,{{ charts.social_tension }}" alt="–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç–∏" class="chart-image">
        </div>
        {% endif %}

        <!-- –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ -->
        {% if charts.combined_trends %}
        <div class="chart-container">
            <h3 class="chart-title">üîÑ –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–Ω–∞–º–∏–∫–∞: –ò–Ω—Ç–µ—Ä–µ—Å vs –ù–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç—å</h3>
            <img src="data:image/png;base64,{{ charts.combined_trends }}" alt="–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫" class="chart-image">
        </div>
        {% endif %}

        <!-- –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞ -->
        {% if charts.correlation_heatmap %}
        <div class="chart-container">
            <h3 class="chart-title">üîó –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π</h3>
            <img src="data:image/png;base64,{{ charts.correlation_heatmap }}" alt="–ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞" class="chart-image">
        </div>
        {% endif %}

        <!-- –°–µ—Ç–µ–≤–æ–π –≥—Ä–∞—Ñ —Å–≤—è–∑–µ–π —Ç–µ–º -->
        <div class="chart-container">
            <h3 class="chart-title">üåê –°–µ—Ç–µ–≤–æ–π –≥—Ä–∞—Ñ —Å–≤—è–∑–µ–π —Ç–µ–º</h3>
            <div id="networkGraph" style="height: 400px;"></div>
        </div>

        <!-- –ê–Ω–∞–ª–∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π -->
        {% if charts.sentiment_analysis %}
        <div class="chart-container">
            <h3 class="chart-title">üòî –î–∏–Ω–∞–º–∏–∫–∞ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π</h3>
            <img src="data:image/png;base64,{{ charts.sentiment_analysis }}" alt="–ì—Ä–∞—Ñ–∏–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π" class="chart-image">
        </div>
        {% endif %}

        <!-- –û–±—ä–µ–º —É–ø–æ–º–∏–Ω–∞–Ω–∏–π -->
        {% if charts.mentions_volume %}
        <div class="chart-container">
            <h3 class="chart-title">üí¨ –û–±—ä–µ–º —É–ø–æ–º–∏–Ω–∞–Ω–∏–π –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö</h3>
            <img src="data:image/png;base64,{{ charts.mentions_volume }}" alt="–ì—Ä–∞—Ñ–∏–∫ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π" class="chart-image">
        </div>
        {% endif %}
    </div>

    <!-- –ê–Ω–∞–ª–∏–∑ –∏ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ -->
    <div class="analysis-grid">
        <!-- –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ -->
        <div class="analysis-card">
            <h3 class="analysis-title">üîó –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑</h3>
            {% if correlations %}
                <div class="correlation-item">
                    <span>–ò–Ω—Ç–µ—Ä–µ—Å ‚Üî –ù–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç—å</span>
                    <span class="correlation-value correlation-{% if correlations.interest_tension_correlation|abs > 0.7 %}strong{% elif correlations.interest_tension_correlation|abs > 0.3 %}moderate{% else %}weak{% endif %}">
                        {{ correlations.interest_tension_correlation|round(3) }}
                    </span>
                </div>
                <div class="correlation-item">
                    <span>–ò–Ω—Ç–µ—Ä–µ—Å ‚Üî –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏—è</span>
                    <span class="correlation-value correlation-{% if correlations.interest_sentiment_correlation|abs > 0.7 %}strong{% elif correlations.interest_sentiment_correlation|abs > 0.3 %}moderate{% else %}weak{% endif %}">
                        {{ correlations.interest_sentiment_correlation|round(3) }}
                    </span>
                </div>
                <div class="correlation-item">
                    <span>–ù–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç—å ‚Üî –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏—è</span>
                    <span class="correlation-value correlation-{% if correlations.tension_sentiment_correlation|abs > 0.7 %}strong{% elif correlations.tension_sentiment_correlation|abs > 0.3 %}moderate{% else %}weak{% endif %}">
                        {{ correlations.tension_sentiment_correlation|round(3) }}
                    </span>
                </div>
                <div class="correlation-item">
                    <span>–£–ø–æ–º–∏–Ω–∞–Ω–∏—è ‚Üî –ò–Ω—Ç–µ—Ä–µ—Å</span>
                    <span class="correlation-value correlation-{% if correlations.mentions_interest_correlation|abs > 0.7 %}strong{% elif correlations.mentions_interest_correlation|abs > 0.3 %}moderate{% else %}weak{% endif %}">
                        {{ correlations.mentions_interest_correlation|round(3) }}
                    </span>
                </div>
            {% endif %}
        </div>

        <!-- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–æ–≤ -->
        <div class="analysis-card">
            <h3 class="analysis-title">üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–æ–≤</h3>
            {% if period_comparison %}
                <div class="period-comparison">
                    {% for period_name, period_data in period_comparison.items() %}
                    <div class="period-item">
                        <div class="period-name">
                            {% if period_name == 'early_2022' %}–ù–∞—á–∞–ª–æ 2022
                            {% elif period_name == 'late_2022' %}–ö–æ–Ω–µ—Ü 2022
                            {% elif period_name == 'early_2023' %}–ù–∞—á–∞–ª–æ 2023
                            {% else %}–ù–µ–¥–∞–≤–Ω–∏–π –ø–µ—Ä–∏–æ–¥{% endif %}
                        </div>
                        <div class="period-stats">
                            <div>–ò–Ω—Ç–µ—Ä–µ—Å: {{ (period_data.avg_interest or 0)|round(1) }}%</div>
                            <div>–ù–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç—å: {{ (period_data.avg_tension or 0)|round(1) }}%</div>
                            <div>–£–ø–æ–º–∏–Ω–∞–Ω–∏—è: {{ (period_data.total_mentions or 0)|int }}</div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
    </div>

    <!-- –ö–ª—é—á–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è -->
    {% if analysis_result.key_events %}
    <div class="key-events">
        <h3 class="analysis-title">üéØ –ö–ª—é—á–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è</h3>
        {% for event in analysis_result.key_events[:5] %}
        <div class="event-item">
            <div class="event-date">{{ event.date[:10] }}</div>
            <div class="event-description">{{ event.description }}</div>
            <div style="margin-top: 5px; font-size: 0.9rem; color: #7f8c8d;">
                –ò–Ω—Ç–µ—Ä–µ—Å: {{ (event.interest_level or 0)|round(1) }}% | 
                –ù–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç—å: {{ (event.social_tension or 0)|round(1) }}%
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>
,{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
// –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –≤–Ω–µ—à–Ω–µ–º JS —Ñ–∞–π–ª–µ
window.networkData = {{ network_data|tojson|safe }};
</script>
<script src="{{ url_for('static', filename='js/svo_dashboard.js') }}"></script>
{% endblock %}