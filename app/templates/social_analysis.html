{% extends "base.html" %}

{% block title %}Анализ социальных сетей{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/social_analysis.css') }}">
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div>
            <h1 class="mb-4">Анализ социальных сетей</h1>
            
            <!-- Навигационные вкладки -->
            <ul class="nav nav-tabs" id="analysisTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="account-tab" data-bs-toggle="tab" data-bs-target="#account" type="button" role="tab">Анализ аккаунта</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="keyword-tab" data-bs-toggle="tab" data-bs-target="#keyword" type="button" role="tab">Поиск по ключевым словам</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="monitoring-tab" data-bs-toggle="tab" data-bs-target="#monitoring" type="button" role="tab">Мониторинг</button>
                </li>
            </ul>
            
            <!-- Содержимое вкладок -->
            <div class="tab-content" id="analysisTabContent">
                <!-- Анализ аккаунта -->
                <div class="tab-pane fade show active" id="account" role="tabpanel">
                    <div class="card mt-3">
                        <div class="card-header">
                            <h5>Анализ конкретного аккаунта</h5>
                        </div>
                        <div class="card-body">
                            <form id="accountAnalysisForm">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="platform" class="form-label">Платформа</label>
                                            <select class="form-select" id="platform" name="platform" required>
                                                <option value="">Выберите платформу</option>
                                                <option value="vk">VKontakte</option>
                                                <option value="telegram">Telegram</option>
                                                <option value="ok">Одноклассники</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="accountUrl" class="form-label">URL аккаунта или ID</label>
                                            <input type="text" class="form-control" id="accountUrl" name="account_url" placeholder="https://vk.com/username или @username" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="postsLimit" class="form-label">Количество постов для анализа</label>
                                            <input type="number" class="form-control" id="postsLimit" name="posts_limit" value="50" min="1" max="1000">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="analysisType" class="form-label">Тип анализа</label>
                                            <select class="form-select" id="analysisType" name="analysis_type">
                                                <option value="full">Полный анализ</option>
                                                <option value="extremism">Только экстремизм</option>
                                                <option value="sentiment">Анализ тональности</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary" id="startAccountAnalysis">
                                    <span class="spinner-border spinner-border-sm d-none" role="status"></span>
                                    Начать анализ
                                </button>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Результаты анализа аккаунта -->
                    <div class="card mt-3 d-none" id="accountResults">
                        <div class="card-header">
                            <h5>Результаты анализа</h5>
                        </div>
                        <div class="card-body" id="accountResultsContent">
                            <!-- Результаты будут загружены здесь -->
                        </div>
                    </div>
                </div>
                
                <!-- Поиск по ключевым словам -->
                <div class="tab-pane fade" id="keyword" role="tabpanel">
                    <div class="card mt-3">
                        <div class="card-header">
                            <h5>Поиск контента по ключевым словам</h5>
                        </div>
                        <div class="card-body">
                            <form id="keywordSearchForm">
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="mb-3">
                                            <label for="keywords" class="form-label">Ключевые слова</label>
                                            <textarea class="form-control" id="keywords" name="keywords" rows="3" placeholder="Введите ключевые слова через запятую" required></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="searchPlatforms" class="form-label">Платформы</label>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" value="vk" id="searchVk" name="platforms" checked>
                                                <label class="form-check-label" for="searchVk">VKontakte</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" value="telegram" id="searchTelegram" name="platforms" checked>
                                                <label class="form-check-label" for="searchTelegram">Telegram</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" value="ok" id="searchOk" name="platforms">
                                                <label class="form-check-label" for="searchOk">Одноклассники</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-success" id="startKeywordSearch">
                                    <span class="spinner-border spinner-border-sm d-none" role="status"></span>
                                    Начать поиск
                                </button>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Результаты поиска -->
                    <div class="card mt-3 d-none" id="keywordResults">
                        <div class="card-header">
                            <h5>Результаты поиска</h5>
                        </div>
                        <div class="card-body" id="keywordResultsContent">
                            <!-- Результаты будут загружены здесь -->
                        </div>
                    </div>
                </div>
                
                <!-- Мониторинг -->
                <div class="tab-pane fade" id="monitoring" role="tabpanel">
                    <div class="card mt-3">
                        <div class="card-header">
                            <h5>Настройка мониторинга</h5>
                        </div>
                        <div class="card-body">
                            <form id="monitoringForm">
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="monitoringPlatform" class="form-label">Платформа</label>
                                            <select class="form-select" id="monitoringPlatform" name="platform" required>
                                                <option value="">Выберите платформу</option>
                                                <option value="vk">VKontakte</option>
                                                <option value="telegram">Telegram</option>
                                                <option value="ok">Одноклассники</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="monitoringName" class="form-label">Название сессии</label>
                                            <input type="text" class="form-control" id="monitoringName" name="session_name" placeholder="Мониторинг экстремизма" required>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="monitoringInterval" class="form-label">Интервал проверки (минуты)</label>
                                            <input type="number" class="form-control" id="monitoringInterval" name="interval" value="60" min="5" max="1440">
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="monitoringKeywords" class="form-label">Ключевые слова для мониторинга</label>
                                    <textarea class="form-control" id="monitoringKeywords" name="monitoring_keywords" rows="3" placeholder="Введите ключевые слова через запятую" required></textarea>
                                </div>
                                <button type="submit" class="btn btn-warning" id="startMonitoring">
                                    <span class="spinner-border spinner-border-sm d-none" role="status"></span>
                                    Запустить мониторинг
                                </button>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Активные сессии мониторинга -->
                    <div class="card mt-3">
                        <div class="card-header">
                            <h5>Активные сессии мониторинга</h5>
                        </div>
                        <div class="card-body" id="activeSessions">
                            <p class="text-muted">Загрузка активных сессий...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Модальное окно для отображения подробных результатов -->
<div class="modal fade" id="resultsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Подробные результаты</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="modalResultsContent">
                <!-- Подробные результаты -->
            </div>
        </div>
    </div>
</div>

{% block scripts %}
<script src="{{ url_for('static', filename='js/social_analysis.js') }}"></script>
{% endblock %}
{% endblock %}